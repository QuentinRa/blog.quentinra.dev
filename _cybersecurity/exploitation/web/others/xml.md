# XML External Entity (XEE)

[![owasptop10](../../../_badges/thm/owasptop10.svg)](https://tryhackme.com/room/owasptop10)
[![xxe_injection](../../../_badges/poat/xxe_injection.svg)](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20Injection)

<div class="row row-cols-md-2"><div>

üìù XML (eXtensible Markup Language) is a language like JSON used to store/share data. XML is like HTML a tree of nodes, with a root, and child elements. An XML file usually starts with a tag called XML prolog.

```xml
<?xml version="1.0" encoding="UTF-8"?>
<rootElement>
    <child></child>
    <group>
        <child attribute="value"></child>
    </group>
</rootElement>
```

The name/attributes/hierarchy of tags/... is defined by you! This is done inside a **Document Type Definition (DTD)**. After your XML Prolog, add a DOCTYPE tag. For the XML above, we may use a DTD such as the one below <small>(generated in PHPStorm)</small>.

```xml
<!DOCTYPE rootElement [
        <!ELEMENT rootElement (child|group)*>
        <!ELEMENT child (#PCDATA)>
        <!ATTLIST child
                attribute CDATA #IMPLIED>
        <!ELEMENT group (child)*>
        ]>
<!-- You may put the content above in a file test.dtd and do -->
<!DOCTYPE rootElement SYSTEM "test.dtd">
```

> There are also **XML Schema Definition** (XSD) for schemas.
</div><div>

An **XML External Entity (XEE)** is an attack exploiting XML parsers used by applications. To be more accurate, you will create a custom **DTD** that will do something on the server. This may lead to

* a **[SSRF attack](../forms/ssrf.md)**: request resource (file/...), map open ports...
* a **sensitive file disclosure**
* a **Denial of Service (DoS)** with recursive instructions
* ...

As usual, there are two kinds of XEE

* **In-band XEE**: same channel to attack and fetch results
* **Out-band/Blind XEE**: different channels to attack and fetch results

<p class="text-center py-3">‚û°Ô∏è Example of payload</p>

Once parsed, this malicious payload will store inside root the content of `/etc/passwd`.

<pre class="language-xml">
<code
>&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE root [&lt;!ENTITY poc SYSTEM 'file:///etc/passwd']&gt;
&lt;root&gt;&poc;&lt;/root&gt;
</code></pre>
</div></div>