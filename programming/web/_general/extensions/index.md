# Browser plugins/extensions

<div class="row row-cols-md-2 mb-3"><div>

You can add extensions/plugins to your browser, for instance, [DarkReader](https://darkreader.org/) or [uBlock](https://ublockorigin.com/). It's quite easy to write your own! ğŸš€

<br>

**Where to learn?** ğŸ«

* [Chrome extensions](https://developer.chrome.com/docs/extensions/mv3/) + [API reference](https://developer.chrome.com/docs/extensions/reference/) + [Examples](https://github.com/GoogleChrome/chrome-extensions-samples)
* [Firefox extensions](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions) + [Examples](https://github.com/mdn/webextensions-examples) (ğŸ‘»)
* [Microsoft Edge extensions](https://learn.microsoft.com/en-us/microsoft-edge/extensions-chromium/) (ğŸ‘»)
</div><div>

There are a few difference between Firefox and chrome. The main difference is that in **Chrome** ğŸŒ you will use

```text!
chrome.xxx.yyy
```

While inside **Firefox** ğŸ¦Š, you will use

```text!
browser.xxx.yyy
```
</div></div>

<hr class="sep-both">

## ğŸ Extension Workflow ğŸ

<div class="row row-cols-md-2 mt-3"><div>

#### Add a local extension ğŸš€

<p></p>

* **Edge**: Go to `edge://extensions/`, enable `Developer mode`, click on `Load unpacked`, and select the folder with your `manifest.json`.

* **Chrome**: Go to `chrome://extensions`, enable `Developer mode`, click on `Load unpacked`, and select the folder with your `manifest.json`.

#### Track errors/logs ğŸ›

On the page where you added your extension

* you can see every error generated by your extension.
* you can open the console associated with your `service_worker`

To debug a script loaded by your `popup.html`, right-click on your extension in the toolbar, and use `Inspect`/`Inspect [...]`.
</div><div>

#### Reloading an extension ğŸ’ª

You have to (manually) reload the extension if you edited

* ğŸ‘‰ï¸ The Manifest
* ğŸ‘‰ï¸ Any script <small>(+ refresh the page)</small>

But, you don't need to if you only edited an HTML file.

* Go to your plugin page
* Use a `refresh`/`reload` button to reload your extension

<details class="details-e">
<summary>Automatically reload the extension</summary>

* Use a (good) template
* Try [chrome-extensions-reloader](https://github.com/arikw/chrome-extensions-reloader) (ğŸ‘»)
* Call `chrome.runtime.reload()` <small>(not available in a content_script)</small>.
</details>
</div></div>

<hr class="sep-both">

## ğŸ“¦ Templates ğŸ“¦

<div class="row row-cols-md-2 mt-3"><div>

Extension Templates can make working with extensions easier.

* âœ¨ These can preconfigure React/Typescript/...
* âœ¨ These can reload automatically the extension
* ...

#### My "Hello, World"

<p></p>

<details class="details-n">
<summary>console.log("Hello, World")</summary>

* Create `manifest.json`

```json
{
  "name": "Hello, World",
  "version": "0.0.1",
  "manifest_version": 3,
  "description": "Print \"Hello, World\" in the console",
  "content_scripts": [
    {
      "matches": ["<all_urls>"],
      "js": ["scripts/main.js"]
    }
  ]
}
```

* Create `scripts/main.js`

```javascript
console.log("Hello, World")
```

* Load your extension
* Visit a website, open the console, you will see the log
</details>
</div><div>

#### chrome-extension-typescript-starter

[GitHub](https://github.com/chibat/chrome-extension-typescript-starter) (1.2k âœ¨, React, Typescript, Jest)

<details class="details-n">
<summary>See my notes</summary>

â¡ï¸ **Get started**

```bash
$ git clone https://github.com/chibat/chrome-extension-typescript-starter.git my-extension
$ cd .\my-extension\
$ npm install
$ npm update
$ npm run watch
```

The extension is automatically reloaded inside the browser.

â¡ï¸ **Bootstrap**

To load bootstrap, download it locally, and store it inside a directory in `public` (ex: lib/). Then in `popup.html`, use

```
<link href="lib/css/bootstrap.min.css" rel="stylesheet">
<script src="lib/js/bootstrap.bundle.min.js"></script>
```

â¡ï¸ **MANIFEST**

For JS files in the Manifest, `src/*.ts` will generate a file `js/*.js`.

```json!
"background": {
    "service_worker": "js/background.js"
},
```
</details>
</div></div>

<hr class="sep-both">

## ğŸº Manifest.json ğŸº

[See Manifest.json](https://developer.chrome.com/docs/extensions/mv3/manifest/)

<div class="row row-cols-md-2 mt-4"><div>

This is a json file defining your extension. The version 2 is being deprecated, consider using the version 3. ğŸš€

```json!
{
  "manifest_version": 3
  ...
}
```

<details class="details-n">
<summary>Metadata: <code>description</code>, <code>version</code>, <code>name</code>, and <code>icons</code></summary>

The `name`, the `description`, and the `version` are up to you.

```json!
  "name": "Hello, World",
  "version": "0.0.1",
  "description": "Print \"Hello, World\" in the console",
```

You should provide an icon in multiple sizes: `16`, `32`, `48` and `128`. The browser will do the resizing for missing resolutions.

```json!
  "icons": {
    "16": "icons/hello_world_16.png",
    "32": "icons/hello_world_32.png",
    "48": "icons/hello_world_48.png",
    "128": "icons/hello_world_128.png"
  }
```
</details>
</div><div>

Then, you can define your extension

* â¡ï¸ `action`: open a popup when clicking on the icon in the toolbar
* â¡ï¸ `content_scripts`: to run code on each page using the DOM
* â¡ï¸ `background`: to run code that do not need to access the DOM

âš ï¸ Inside a `content_scripts`, most of the attributes of `chrome`/`browser` aren't available. Also, some properties are only available after asking for the [permission](https://developer.chrome.com/docs/extensions/mv3/declare_permissions/) first.

```json!
  "host_permissions": [ "://*" ],
  "permissions": ["activeTab"]
```

âœ¨ Usually, to have access to `chrome.xxx`, the permission is called `xxx`.
</div></div>