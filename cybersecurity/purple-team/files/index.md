# File investigation

<div class="row row-cols-lg-2"><div>

Any file you find, be it during [Digital forensics](/cybersecurity/blue-team/topics/forensics.md) or during the red team activities, may have:

* üêü Hidden content in a file
  * A file inside another file
  * A text inside an image
* üëÄ Username/Name of the one that created the file
* üç´ Information generated by the application that created the file
* ...
</div><div>

This is why you should investigate any file you get your hands on.
 
‚û°Ô∏è For instance, if you notice a "big" image <small>(usually >1 MB)</small>, you may want to check if this is really an image.
</div></div>

<hr class="sep-both">

## Metadata

[![introdigitalforensics](../../_badges/thm/introdigitalforensics.svg)](https://tryhackme.com/room/introdigitalforensics)

<div class="row row-cols-lg-2"><div>

Any file has metadata, which is data that provides information on the file, such as the author, the creation date...

#### PDF metadata

You can use online tools, your PDF reader "details" menu, or `pdfinfo`.

```shell!
$ sudo apt install poppler-utils
$ pdfinfo xxx.pdf
Author:         XXX
Creator:        Microsoft Word
CreationDate:   Sun Aug 28 22:12:17 2022 EDT
ModDate:        Sun Aug 28 22:12:17 2022 EDT
[...]
PDF version:    1.7
```
</div><div>

#### Image metadata

[![agentsudoctf](../../_badges/thm-p/agentsudoctf.svg)](https://tryhackme.com/room/agentsudoctf)
[![exif_metadata](../../_badges/rootme/steganography/exif_metadata.svg)](https://www.root-me.org/fr/Challenges/Steganographie/EXIF-Metadata)

You can use `exiftool`, [jimpl](https://jimpl.com/), [IMV](https://www.geekyhumans.com/tools/image-metadata-viewer)... Also, do a reverse image search üßµ.

```shell!
$ sudo apt install libimage-exiftool-perl
$ exiftool xxx.png
[...]
File Modification Date/Time     : 2022:10:22 18:01:32-04:00
[...]
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
[...]
Software                        : www.inkscape.org
[...]
```
</div></div>

<hr class="sep-both">

## Steganography

[![agentsudoctf](../../_badges/thm-p/agentsudoctf.svg)](https://tryhackme.com/room/agentsudoctf)
[![c4ptur3th3fl4g](../../_badges/thm-p/c4ptur3th3fl4g.svg)](https://tryhackme.com/room/c4ptur3th3fl4g)
[![chillhack](../../_badges/thm-p/chillhack.svg)](https://tryhackme.com/room/chillhack)

<div class="row row-cols-lg-2"><div>

Steganography is a technique in which a person hides data inside the pixels of an image. It's used to secretly transfer data.

If the hidden content is not protected by a password, you can extract it using the `steghide` command or [zsteg](https://github.com/zed-0xff/zsteg)/[stegoveritas](https://github.com/bannsec/stegoVeritas) for PNGs:

```ps
$ steghide info file        # check
$ steghide extract -sf file # extract
$ zsteg file                # refer to the help
$ stegoveritas file         # refer to the help
```

‚ö†Ô∏è If prompted for a password, **try a blank password**.

üíé It's possible that when using the `strings` command we see some interesting parts of the hidden content.
</div><div>

Otherwise, you may try to brute force the password using tools such as [stegseek](https://github.com/RickdeJager/stegseek) <small>(0.8k ‚≠ê)</small> or [StegCracker](https://github.com/Paradoxis/StegCracker) <small>(0.5k ‚≠ê, 2020 ü™¶)</small>.

```ps
# https://github.com/RickdeJager/stegseek
$ stegseek file wordlist
$ stegcracker file wordlist
```

**Additional tools** üëª

* See also [futureboy](https://futureboy.us/stegano/) steg tools.
* See also [330k encoders](https://330k.github.io/misc_tools/unicode_steganography.html) <small>(Unicode Steganography)</small>
* See also [steganographr](https://neatnik.net/steganographr/) <small>(zero-width characters)</small>
</div></div>

<hr class="sep-both">

## File steganography

[![agentsudoctf](../../_badges/thm-p/agentsudoctf.svg)](https://tryhackme.com/room/agentsudoctf)
[![exif_thumbnail](../../_badges/rootme/steganography/exif_thumbnail.svg)](https://www.root-me.org/en/Challenges/Steganography/EXIF-Thumbnail)

<div class="row row-cols-lg-2"><div>

File steganography is a subcategory of steganography in which a file is hidden in another file. Using [binwalk](https://github.com/ReFirmLabs/binwalk) <small>(10.0k ‚≠ê)</small> you can investigate:

```ps
$ binwalk file.png
# from xxx to yyy: PNG
# from zzz to ttt: ZIP
```

And you can extract files using `-e`

```ps
$ binwalk -e file.png
```

If the image is a thumbnail, you could also use:

```ps
$ exiftool -b -ThumbnailImage file.jpg > extracted.jpg
```
</div><div>

You can alternatively use `dd` to extract a file:

```ps
# extract the size by skipping the 34562 bytes
$ dd bs=34562 skip=1 if=file.png of=file.zip
$ ls
file.png file.zip
```

üëâ If there was a ZIP inside the PNG, and you can't unzip it, try with `7z x xxx.zip` or use `dd` to extract the file.
</div></div>

<hr class="sep-both">

## Audio files

[![c4ptur3th3fl4g](../../_badges/thm-p/c4ptur3th3fl4g.svg)](https://tryhackme.com/room/c4ptur3th3fl4g)
[![wav_spectral_analysis](../../_badges/rootme/steganography/wav_spectral_analysis.svg)](https://www.root-me.org/en/Challenges/Steganography/WAV-Spectral-analysis)

<div class="row row-cols-lg-2"><div>

#### Audacity

You can use [Audacity](https://www.audacityteam.org/) to analyze audio files.

```shell!
$ sudo apt install audacity
$ audacity file.wav
```

Click on the filename, and select "spectrogram." If the text is not readable, you will have to zoom. You can either or both:

* Reduce the frequency interval, by clicking on the filename again, selecting "spectrogram settings", and setting the min/max frequency <small>(the current scale is shown at the start of the track window)</small>

* Increase the height of the track window
</div><div>

#### sonic-visualiser

You can also use [sonic-visualiser](https://github.com/sonic-visualiser/sonic-visualiser) <small>(0.4k ‚≠ê)</small>:

```shell!
$ sudo apt install sonic-visualiser
$ sonic-visualiser file.wav
```

Right-click on the track and in "Layers," select "Spectrogram." Use your mouse to zoom in.

#### Others

* [academo spectrum analyzer](https://academo.org/demos/spectrum-analyzer/)
* [dcode spectrum analyzer](https://www.dcode.fr/spectral-analysis)
* [morsecode audio decoder](https://morsecode.world/international/decoder/audio-decoder-adaptive.html)
* `spek` command
</div></div>

<hr class="sep-both">

## Additional Notes

<div class="row row-cols-lg-2"><div>

#### APNG - PNG GIF

[![apng_just_a_png](../../_badges/rootme/steganography/apng_just_a_png.svg)](https://www.root-me.org/fr/Challenges/Steganographie/APNG-Just-A-PNG-2995)

An image similar to a GIF that contains images and delays between each. It loads the next image after the delay.

```shell!
$ sudo apt-get install apngdis
$ apngdis image.apng
$ cat *.txt | cut -d '=' -f2 | cut -d '/' -f1 | xargs | tr ' ' ','
```
</div><div>
</div></div>

<hr class="sep-both">

## üëª To-do üëª

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

* Stegosploit
* reverse search
</div><div>
</div></div>