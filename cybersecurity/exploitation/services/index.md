# Protocols & services notes

[![protocolsandservers](../../_badges/thmp/protocolsandservers.svg)](https://tryhackme.com/room/protocolsandservers)
[![protocolsandservers2](../../_badges/thmp/protocolsandservers2.svg)](https://tryhackme.com/room/protocolsandservers2)
[![networkservices](../../_badges/thmp/networkservices.svg)](https://tryhackme.com/room/networkservices)
[![networkservices2](../../_badges/thmp/networkservices2.svg)](https://tryhackme.com/room/networkservices2)

This couse IS NOT a course about protocols/services, the knowledge inside is partial as it's intended to be used in complement of the [Protocols & Services course](/info/networking/protocols/index.md). In this course, there will only be additional notes useful from a cybersecurity point of view.

> You may also check [Cyber/Bruteforce services](/cybersecurity/exploitation/services/bruteforce.md) to try to bruteforce a service credentials.

<hr class="sep-both">

## FTP - 21 (tcp)

[![kenobi](../../_badges/thm-p/kenobi.svg)](https://tryhackme.com/room/kenobi)
[![startup](../../_badges/thm-p/startup.svg)](https://tryhackme.com/room/startup)
[![cowboyhacker](../../_badges/thm-p/cowboyhacker.svg)](https://tryhackme.com/room/cowboyhacker)

[See FTP protocol for more information](/info/networking/protocols/index.md#-ftp---21-tcp)

➡️&nbsp; a hacker may access to interesting files

<div class="row row-cols-md-2"><div>

* Anonymous user may have been enabled

```bash
$ ftp anonymous@IP
```

> If asking for a password, try with a blank password.
</div><div>

* **ProFTPD 1.3.5**: There was a failure that allowed users to move files from a non-mounted path to the mounted path. You could steal an id_rsa for instance.

</div></div>

<hr class="sep-both">

## SSH - 22 (tcp)

[See SSH protocol for more information](/info/networking/protocols/index.md#-ssh---22-tcp)

➡️&nbsp; a hacker may get access to the machine

<div class="row row-cols-md-2"><div>

It's usually helpful to know that users may have a folder `.ssh` in their home, in which there are SSH Keys/... To avoid transferring passwords, servers can allow users to connect using an SSH private key. The key may be protected by a passphrase. Once the user enter the passphrase, the key is unlocked, and can be used by `ssh`.

* If there is no passphrase, a hacker can use it to connect to a server.
* Else, the hacker may try to [brute force it](/cybersecurity/random/crack_password/index.md#ssh-private-key---passphrase-cracking).
</div><div>

The private key is usually called `id_rsa`, while the public key is usually called `id_rsa.pub`. You will find inside an email which was used to sign the key. The email can help finding the username.

```bash
# if you downloaded a key, 
# you need to set the permissions correctly
$ chmod 600 /tmp/id_rsa
$ ssh login@IP -i /tmp/id_rsa
```
</div></div>

<hr class="sep-both">

## SMTP - 25 (tcp)

[See SMTP protocol for more information](/info/networking/protocols/index.md#-smtp---25-tcp)

➡️&nbsp; a hacker may get credentials (hashed, must be cracked) that may have been reused for another service

<div class="row row-cols-md-2"><div>

* Metasploit

```bash
msf6 > use auxiliary/scanner/smtp/smtp_version # version
msf6 > use auxiliary/scanner/smtp/smtp_enum # users...
```
</div><div>

* Dig info using nmap

```bash
$ nmap IP -p 25 --script "*smtp*"
```

* Using `smtp-user-enum` <small>(not always working)</small>

```bash
# https://www.kali.org/tools/smtp-user-enum/
$ smtp-user-enum -M VRFY -u root -t IP
```
</div></div>

<hr class="sep-both">

## RPC - 111 (tcp/udp)

[![kenobi](../../_badges/thm-p/kenobi.svg)](https://tryhackme.com/room/kenobi)

[See RPC protocol for more information](/info/networking/protocols/index.md#-rpc---111-tcpudp)

<div class="row row-cols-md-2"><div>

* Exemple to query information about NFS mounts

```bash
$ nmap IP -p 111 --script=nfs-ls,nfs-statfs,nfs-showmount
```
</div><div>
</div></div>

<hr class="sep-both">

## Samba - 445 (or 139 before, tcp)

[![kenobi](../../_badges/thm-p/kenobi.svg)](https://tryhackme.com/room/kenobi)

[See Samba protocol for more information](/info/networking/protocols/index.md#-samba---445-or-139-before-tcp)

➡️&nbsp; a hacker may access to interesting files, exploit a vulnerability such as WannaCry...

<div class="row row-cols-md-2"><div>

* Find shares using nmap

```bash
$ nmap IP -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse
```

* Try connecting anonymously with no password (leave blank)

```bash
$ smbclient //IP/share_name -U Anonymous
$ smbclient //IP//Anonymous -U Anonymous
```
</div><div>

* You can also use `smbmap` to find users/shares/files/...

```bash
$ smbmap -H IP
```

* You can use [enum4linux](https://github.com/CiscoCXSecurity/enum4linux) (0.7k ⭐) to find shares, and users.

```bash
$ enum4linux options ip
$ enum4linux -a ip
# -a : list all
# -U : list of users
# -M : list of devices
# -S : list of shares
# -o : print os information
# -i : print printer information
# -v : verbose
```
</div></div>

<hr class="sep-both">

## NFS - 2049 (tcp)

[![kenobi](../../_badges/thm-p/kenobi.svg)](https://tryhackme.com/room/kenobi)

[See NFS protocol for more information](/info/networking/protocols/index.md#-nfs---2049-tcp)

➡️&nbsp; a hacker may access to interesting files, or upload SUID files that will give them root access on the machine.

<div class="row row-cols-md-2"><div>

* Find mounted folders with nmap

```bash
$ nmap IP -p 2049 --script=nfs-ls,nfs-statfs,nfs-showmount
```
</div><div>

> On Linux, when root_squashing is disabled, a local root user is mapped to the remote root user, allowing the local root user to create SUID files.
</div></div>

<hr class="sep-both">

## RDP - 3389 (tcp)

[See RDP protocol for more information](/info/networking/protocols/index.md#-remote-desktop-protocol-rdp---3389-tcp)

➡️&nbsp; a hacker may brute force weak credentials or exploit vulnerabilities

* [BlueKeep Vulnerability](https://en.wikipedia.org/wiki/BlueKeep) (2019)