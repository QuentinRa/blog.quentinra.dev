# Exploit a webserver

[![introwebapplicationsecurity](../../_badges/thm/introwebapplicationsecurity.svg)](https://tryhackme.com/room/introwebapplicationsecurity)
[![contentdiscovery](../../_badges/thm/contentdiscovery.svg)](https://tryhackme.com/room/contentdiscovery)
[![walkinganapplication](../../_badges/thm/walkinganapplication.svg)](https://tryhackme.com/room/walkinganapplication)
[![httpindetail](../../_badges/thm/httpindetail.svg)](https://tryhackme.com/room/httpindetail)
[![authenticationbypass](../../_badges/thmp/authenticationbypass.svg)](https://tryhackme.com/room/authenticationbypass)
[![owasptop10](../../_badges/thm/owasptop10.svg)](https://tryhackme.com/room/owasptop10)

*According to TryHackMe, there are 4 categories of failures related to webservices.*

<div class="row row-cols-md-2"><div>

**Identification and Authentication Failure** üîë

* The website does not prevent brute force
* The website allows users to use weak passwords
* The website does not encrypt passwords
	
<br>

**Broken Access Control** üì≠ <small>(users can access files/URLs they shouldn't)</small>

* The principle of the least privilege is not applied correctly
* Someone can use someone else token/ID to do...
* A user can access "logged-only" pages without logging in
</div><div>

**Injections** ü™§

* There is insufficient or no validation at all
* There is insufficient or no sanitization at all

<p>&nbsp;</p>

**Cryptographic Failures** üîì

* The server is using clear text
* The server allows/uses HTTP instead of HTTPS
* The server uses a weak cryptographic algorithm
</div></div>

<hr class="sep-both">

## Terminology

<div class="row row-cols-md-2"><div>

A URL is a suite of: a scheme (http/https), a username, a password, `@`, a domain, `:`, a port, a route, a query (`?`), and a fragment (`#`). Most parameters are optional, the URLs you will use will mostly look like this

```
http://example.com
http://example.com:80
https://example.com
https://example.com:443
https://example.com/route/?query#fragment
127.0.0.1
127.0.0.1:80
[...]
```
</div><div>


* Web Application Firewall (WAF): protect web apps against DDOS/..., and analyze/limit-rate traffic from bots.

* Content Delivery Networks (CDN): servers that are used to store static resources of a website. When a website needs a resource, the nearest CDN server is used, allowing a faster response.

* Load Balancers: interface between clients and server, distributing the load among the available servers using algorithms such as round-robin <small>(in turn)</small>, or weighted <small>(is server busy?)</small>. There are periodic checks to ensure that servers are still online, and if there is no response, a server is considered down until proven otherwise.

</div></div>

<hr class="sep-both">

## OWASP, and references

<div class="row row-cols-md-2"><div>

[OWASP](https://owasp.org/) (The Open Source Foundation for Application Security Project) is a foundation that is very well-known for its resources to improve website security. The release every year the [**Top 10 vulnerabilities**](https://owasp.org/Top10/).

* See [OWASP Cheat Sheet Series](https://cheatsheetseries.owasp.org/) (22.1k ‚≠ê)

* See [OWASP Juice Shop](https://github.com/juice-shop/juice-shop) (7.4k ‚≠ê) / [THM juiceshop](https://tryhackme.com/room/owaspjuiceshop): practice

* See [OWASP mutillidae](https://github.com/webpwnized/mutillidae) (0.9k ‚≠ê) / [THM mutillidae](https://tryhackme.com/room/owaspmutillidae) : pratice

* See [OWASP Web Security Testing Guide](https://owasp.org/www-project-web-security-testing-guide/) (5k ‚≠ê, [PDF](https://github.com/OWASP/wstg/releases/download/v4.2/wstg-v4.2.pdf))
</div><div>

**Dummy websites for practice**

* [Damn Vulnerable Web Application (DVWA)](https://github.com/digininja/DVWA) (6.8k ‚≠ê) / [THM DVWA](https://tryhackme.com/room/dvwa)
* [pygoat](https://github.com/adeyosemanputra/pygoat) (0.1k ‚≠ê, django)
* [bugbountyhunter training](https://www.bugbountyhunter.com/training/)
* [bwapp](http://www.itsecgames.com/download.htm) which isn't maintained since 2014, and does not seem very popular. There is  [this repository](https://github.com/raesene/bWAPP) (95 ‚≠ê) about it, and [bWapp solutions](https://github.com/skiptomyliu/solutions-bwapp) (152 ‚≠ê).

**Checklists**

* [appsec-labs.com/web-attacks-tests](https://appsec-labs.com/web-attacks-tests/)
</div></div>

<hr class="sep-both">

## Discovery of a website

> Below is a sort of checklist of what you will have to go through when exploring a website, but to get what you want, you will have to look at specific pages according to your case.

<div class="row row-cols-md-2"><div>

**Website mapping** üìå

As a penetration tester, you will have to list every feature of the website, and their route. For instance, "list all products": `/products,` "list a product": `/products?id=x`. This is done as you explore by BurpSuite if you are redirecting requests through the proxy, even if you don't intercept them.

<br>

**Look at the source of the website** (<kbd>CTRL+U</kbd>)

[![picklerick](../../_badges/thm-p/picklerick.svg)](https://tryhackme.com/room/picklerick)

* is there hidden elements?
* is there information in HTML comments?

<br>

**Look for logic flaws**

A logic flaw is when a programmer is thinking that a user will do something, such as browsing pages in a specific order, or submitting an email in an "email input field", and does not check, or not properly check, for those that take a path different from intended.

Another logic flaw could be related to websites using a username to check if a user is allowed to see the "admin" side of the website. Maybe some tricks like an username " admin" may bypass the check.

<br>

**Look for frameworks** [See frameworks](frameworks/index.md)

Most developers are using a framework, which is a sort of box of utilities to make a website more easily.

<br>

**Analyze the network**

You may use the dev console network tab to analyze requests, and responses sent to the server. Once you click on a request, there are multiple tabs, for requests, responses...

Some misconfigured servers are, for instance, sending the web service name <small>(Nginx, Apache, IIS, Node.js)</small>, and sometimes even the version.

<br>

**Analyze the javascript**

You may use the dev console debugger, after adding a breakpoint in the JavaScript, to analyze the javascript code, if needed.

<br>

**/robots.txt and /sitemap.xml**

[![picklerick](../../_badges/thm-p/picklerick.svg)](https://tryhackme.com/room/picklerick)

Robots.txt is listing pages that crawlers (search engine robots) shouldn't crawl. There may be some routes that even clients were not aware of inside.

There is also a link to the website "sitemap", which is generated by the developer to help search engine index the website. If the sitemap wasn't updated, you may find interesting routes, meaning not available for the "usual" visitor, but that were available before, that were not removed, and that are maybe vulnerable.
</div><div>

**Forced Browsing** [See Forced Browsing](fuzz/forced_browsing.md)

This is a technique of not using the website links to navigate to another page, but rather trying manually/using a tool with a list of routes that may exist, and trying them all while hoping to find some gold.

<br>

**Insecure Direct Object References (IDOR)** [See fuzzing](fuzz/index.md)

[![idor](../../_badges/thm/idor.svg)](https://tryhackme.com/room/idor)
[![neighbour](../../_badges/thm-p/neighbour.svg)](https://tryhackme.com/room/neighbour)

A failure in which we can guess given a URL how to access other elements,
and if we change the URL <small>(id=10$\to$id=11)</small>. It could be a get form with predictable values, or a folder with predictable filenames... It could also be unpredictable values, and in such case, the best test would be to create two accounts, and see if you can swap the potential IDOR. They can be found in forms, in the JavaScript, in cookies...

<br>

**Find usernames/emails** [See Brute force forms](forms/index.md)

You could achieve this using the website API if there is one, and/or its interface, such as register forms: "this username is already taken", or the same process for emails with the password forgot page...

<br>

**Wayback machine**

You can look for previous versions of the website stored on the [Wayback machine](https://archive.org/web/), if any. Google has also a feature to see cached versions of a website, but it's not very useful for this purpose.

<br>

**OSINT**

If the company tried to hire employees in the past, you may find information about the framework or stuff like this in the job offers.

If you can find employees on GitHub/..., you may find what language/frameworks they are using for their websites.

You may also look for personal websites/posts/interests of employees, because that may be an indicator too.
</div></div>

<hr class="sep-both">

## Tools

<div class="row row-cols-md-2"><div>

* Spoof User-Agent

You can install an extension to make the target website believe that you are using another browser. Look for **User-Agent Switcher** extensions on Google. You can try them on [whatismybrowser](https://www.whatismybrowser.com/).

* Use a proxy

You may use a proxy as an intermediary for your requests. If you do, then you can use the **FoxyProxy extension** of your browser to easily swap between no proxy, and your proxies configurations.
</div><div>

* Disable scripts

You may do that to bypass JavaScript verifications. You can use plugins such as [noscript](https://noscript.net/), or ublock by clicking on the following icon

![ublock_disable_scripts](_images/ublock_disable_scripts.png)

* [wappalyzer](https://github.com/wappalyzer/wappalyzer) (7.8k ‚≠ê) to find frameworks, their versions... It can also be installed as a browser extension or used via their [website](https://www.wappalyzer.com/).

* [Beef](https://github.com/beefproject/beef) (7.8k ‚≠ê): The Browser Exploitation Framework Project
</div></div>

<hr class="sep-both">

## Mitigations

<div class="row row-cols-md-2 mt-4"><div>

* üîí Display generic error messages, disable errors, and do not give much information

* üöß Test your endpoints with invalid values: 0, -1, characters, symbols...
</div><div>

* üî´ Do not trust anything coming from the user, its browser, or even your database. Basically, 0-Trust.
</div></div>