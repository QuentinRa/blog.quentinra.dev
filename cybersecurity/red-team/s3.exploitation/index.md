# Third step - Exploitation

[![vulnerabilities101](../../_badges/thm/vulnerabilities101.svg)](https://tryhackme.com/room/vulnerabilities101)
[![exploitingavulnerabilityv2](../../_badges/thmp/exploitingavulnerabilityv2.svg)](https://tryhackme.com/room/exploitingavulnerabilityv2)
[![vulnerabilitycapstone](../../_badges/thmp/vulnerabilitycapstone.svg)](https://tryhackme.com/room/vulnerabilitycapstone)
[![attackerkb](../../_badges/thm/attackerkb.svg)](https://tryhackme.com/room/attackerkb)

<div class="row row-cols-md-2"><div>

Exploitation ğŸ’¥ is the third step of the pentester activities. We attempt to exploit a vulnerability discovered during investigation.

Some activities are:

* ğŸ”‘ Brute forcing credentials
* ğŸ’€ Exploiting a known (unpatched) vulnerability
  * in a service
  * in an application
  * in a website/an api
  * ...
* ...

ğŸ“Œ The goal is to get **remote access to the target**.
</div><div>

You will usually look for an unpatched vulnerability, and try to exploit it to upload or run commands to create a remote shell.

Vulnerabilities can be categorized in 5 categories:

* ğŸª¸ Operating System
* ğŸ”¥ Misconfigurations <small>(Version Disclosure, Sensitive Data Exposure, Security Misconfigurations)</small>
* ğŸ” Weak credentials
* ğŸ˜ Logic flaws <small>(Insecure Deserialization)</small>
* ğŸ§‘ Human errors

Note that not all vulnerabilities are exploitable, and not all vulnerabilities have a public exploit to exploit them.
</div></div>

<hr class="sep-both">

## Remote shell âš“

[![introtoshells](../../_badges/thmp/introtoshells.svg)](https://tryhackme.com/room/introtoshells)
[![Reverse Shell](../../_badges/poat/reverse_shell.svg)](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)

<div class="row row-cols-md-2"><div>

In CTFs, you will most of the time be able to get a remote shell access to the target, similarily to a SSH access. There is a need for a 

* **server** which is accepting connection <small>(most likely the hacker host)</small> 
* **client** which is connecting to the server <small>(most likely the victim)</small>

There are 3 kind of ways to get a remote shell:

* [Web shell](shell/web_shell.md)
* [Reverse shell](shell/reverse_shell.md)
* Blind shell

â¡ï¸ To avoid alerting IDS, a bind/reverse shell should use a protocol that would not be suspected such as HTTPS (`443`). 

ğŸ”’ Most of the time, bind/reverse shells are blocked by firewalls.
</div><div>

Most remote shell that we create are instable:

* ğŸ˜¥ you can't use commands requiring user input <small>(ex: `sudo`)</small>
* ğŸƒ You can't clear nor resize your terminal
* ğŸ¦¥ There is no auto-completion, you can't use arrows...
* â›” CTRL+C kill the shell, not the command

We can use a wrapper for the client/server <small>(the one on your machine)</small> to make things really nice, or we can [try to manually patch the shell](shell/manual.md).

* [Penelope wrapper](shell/penelope.md)
* [pwncat wrapper](shell/pwncat.md)
* [rlwrap wrapper](shell/rlwrap.md)
* [socat wrapper](shell/socat.md)

Not every shell can be upgraded <small>(test another client...)</small>. A wrapper, may be available both as client or server depending on what you do.
</div></div>

<hr class="sep-both">

## Vulnerability databases

<div class="row row-cols-md-2 mt-4"><div>

#### Vulnerabilities identifiers

To identify and classify vulnerabilities, you can use:

* ğŸ“Œ **CVE** <small>(Common Vulnerabilities and Exposures)</small> is a dictionary of every known vulnerability. The format is **CVE-YEAR-ID**.

* ğŸ“ **CWE** <small>(Common Weakness Enumeration)</small> is a list of common weaknesses in applications, grouped in categories.

<br>

#### Vulnerability scoring

There are 2 well-known systems to rank vulnerabilities.

* ğŸ€ **CVSS** <small>(Common Vulnerability Scoring System)</small> which was released in 2005, and is free and open-source. [A CVE is ranked from 0 to 10](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator).

* ğŸ’µ **VPR** <small>(Vulnerability Priority Rating)</small> is a modern way based on the risk for the organization that uses it. It ranges from 0 to 100.

<br>

#### Proof Of Concept

When a vulnerability is discovered, a proof of concept (**PoC**) may be written to demonstrate that the vulnerability is exploitable. As a pentester, you may look for them to exploit a vulnerability.

â¡ï¸ Use GitHub, GitLab, and Google to look for them...
</div><div>

There are **many** vulnerability databases. You should use 2-3 as they may have different information <small>(community info, list of exploits...)</small>.

* [Exploit DB](db/exploit_db.md) - CVE with exploits

* [Attacker KB](db/attacker_kb.md) - community reviews

* [CVE details](db/cve_details.md) - every CVE

* [CVE.ORG (MITRE)](db/cve_org.md) - every CVE

* [Snyk](db/snyk.md) - focus on web applications

* [Rapid7](db/rapid7.md) - a bit of focus on metasploit

* [Circl](db/circl.md) - simplified information for each CVE

* [NVD](db/nvd.md) - NIST vulnerability database (NVD)

* [MSRC](db/msrc.md) - Microsoft CVEs

* [vulners](db/vulners.md) - Vulnerabilty search engine

* [Trickest/CVE](db/trickest_cve.md) - CVE + PoC

* [CVEList](db/cvelist.md) - GIT with every CVE

* [InTheWild](db/inthewild.md) - CVE used in the "wild"

* [cxsecurity](https://cxsecurity.com/) - CVE with exploits

* [packetstormsecurity](https://packetstormsecurity.com/files/tags/exploit/) - CVE with exploits

</div></div>

<hr class="sep-both">

## Common techniques

<div class="row row-cols-md-2"><div>

#### Password cracking ğŸ”‘

You may have to crack passwords

* [See hash cracking](/cybersecurity/cryptography/algorithms/hashing/index.md#hash-cracking) (john/hashcat)
* [See hydra](tools/hydra.md) (brute force services such as ssh/ftp/...)
* [See nmap](../s2.discovery/tools/nmap.md#brute-force-scripts) (uncommon alternative to hydra)

â¡ï¸ We usually call it "brute forcing", but it's a dictionary attack using a [wordlist](/cybersecurity/red-team/_knowledge/index.md#wordlists-) such as `rockyou.txt` in most scenarios.
</div><div>

#### Vulnerability exploitation ğŸ’€

Use a pre-written script provided by a vulnerability database to exploit a detected exploitable vulnerability.
</div></div>

<hr class="sep-both">

## Common vulnerabilities ğŸª¦

<div class="row row-cols-md-2"><div>

Applications

* Memory leaks
* Buffer Overflow
* Malicious iFrames
* HTTP 302 Redirect (Open Redirect?)
* File Upload (see the network request when uploading)
* Remote Command Execution
* Remote Code Execution

Databases

* SQL injection
* SQL truncation

Configuration

* Too much details in errors
* [Session_fixation](https://en.wikipedia.org/wiki/Session_fixation)
* Encryption (BREACH/CRIME attacks)
* rootkit, bootkit

Insecure deserialization

* DoS with a recursive regular expression to parse
</div><div>

Sensitive files exposed

* KeePass KbDx

Other injections

* Server-Side Template Injection
* Fault injection
* [Email_injection](https://en.wikipedia.org/wiki/Email_injection)
* [HTTP_header_injection](https://en.wikipedia.org/wiki/HTTP_header_injection)
* XXE (API SOAP (DTD), disable it)

Authentication

* Weak or default credentials
* Password reuse
* Vulnerable to brute force
* Vulnerable reset password
* Authentication token in the URL
* Vulnerable security questions (unencrypted, easy to guess)
* Pass-The-Hash Attack
</div></div>

<div class="row row-cols-md-2"><div>

**Identification and Authentication Failure** ğŸ”‘

* The website does not prevent brute force
* The website allows users to use weak passwords
* The website does not encrypt passwords

<br>

**Broken Access Control** ğŸ“­ <small>(users can access files/URLs they shouldn't)</small>

* The principle of the least privilege is not applied correctly
* Someone can use someone else token/ID to do...
* A user can access "logged-only" pages without logging in
</div><div>

**Injections** ğŸª¤

* There is insufficient or no validation at all
* There is insufficient or no sanitization at all

<p>&nbsp;</p>

**Cryptographic Failures** ğŸ”“

* The server is using clear text
* The server allows/uses HTTP instead of HTTPS
* The server uses a weak cryptographic algorithm
</div></div>

<hr class="sep-both">

## ğŸ‘» To-do ğŸ‘»

Stuff that I found, but never read/used yet.

<div class="row row-cols-md-2"><div>

Exploitation

* SQL
  * [Old - Database](/_kmp/_cybersecurity/exploitation/database/index.md)
  * [Old - SQLi](/_kmp/_cybersecurity/exploitation/database/sqli/index.md)
  * [Old - sqlmap](/_kmp/_cybersecurity/exploitation/database/sqlmap/index.md)
* [Old - msfconsole](/_kmp/_cybersecurity/exploitation/general/metasploit/msfconsole.md)

XXX

* [ZDI](https://www.zerodayinitiative.com/)
* [GitHub Advisory Database](https://github.com/advisories).
* [clFrex](https://cifrex.org/)
* [AD mindmap orange](https://orange-cyberdefense.github.io/ocd-mindmaps/)
</div><div>

* [Old - HTTP Headers](/_kmp/_cybersecurity/exploitation/web/others/headers.md)
* [Old - Subdomains](/_kmp/_cybersecurity/exploitation/web/subdomains/index.md)
* [Old - Cookies](/_kmp/_cybersecurity/exploitation/web/others/cookies.md)
* [Old - XML External Entity](/_kmp/_cybersecurity/exploitation/web/others/xml.md)
* [Old - Forms](/_kmp/_cybersecurity/exploitation/web/forms/index.md)
* [Old - Brute force Forms](/_kmp/_cybersecurity/exploitation/web/forms/bruteforce.md)
* [Old - File/Path exploits](/_kmp/_cybersecurity/exploitation/web/forms/file_path_exploits.md)
* [Old - XSS (JavaScript)](/_kmp/_cybersecurity/exploitation/web/forms/xss.md)
* [Old - SSRF](/_kmp/_cybersecurity/exploitation/web/forms/ssrf.md)
* [Old - Command injection](/_kmp/_cybersecurity/exploitation/web/forms/command_injection.md)
* [Old - File upload](/_kmp/_cybersecurity/exploitation/web/forms/file_upload.md)
* [Old - Burp Suite](/_kmp/_cybersecurity/exploitation/web/burpsuite/index.md)
</div></div>