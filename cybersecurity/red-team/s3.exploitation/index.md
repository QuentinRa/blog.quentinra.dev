# Third step - Exploitation

[![vulnerabilities101](../../_badges/thm/vulnerabilities101.svg)](https://tryhackme.com/room/vulnerabilities101)
[![exploitingavulnerabilityv2](../../_badges/thmp/exploitingavulnerabilityv2.svg)](https://tryhackme.com/room/exploitingavulnerabilityv2)
[![vulnerabilitycapstone](../../_badges/thmp/vulnerabilitycapstone.svg)](https://tryhackme.com/room/vulnerabilitycapstone)

<div class="row row-cols-lg-2"><div>

Exploitation 💥 is the third step of the pentester activities. We attempt to exploit a vulnerability discovered during investigation.

Some activities are:

* 🔑 Brute forcing credentials
* 💀 Exploiting a known (unpatched) vulnerability
  * in a service
  * in an application
  * in a website/an api
  * ...
* ...

📌 The goal is to get **remote access to the target**.
</div><div>

You will usually look for an unpatched vulnerability, and try to exploit it to upload or run commands to create a remote shell.

Vulnerabilities can be categorized in 5 categories:

* 🪸 Operating System
* 🔥 Misconfigurations <small>(Version Disclosure, Sensitive Data Exposure, Security Misconfigurations)</small>
* 🔏 Weak credentials
* 😎 Logic flaws <small>(Insecure Deserialization)</small>
* 🧑 Human errors

Note that not all vulnerabilities are exploitable, and not all vulnerabilities have a public exploit to exploit them.
</div></div>

<hr class="sep-both">

## Remote shell ⚓

[![introtoshells](../../_badges/thmp/introtoshells.svg)](https://tryhackme.com/room/introtoshells)
[![Reverse Shell](../../_badges/poat/reverse_shell.svg)](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)

<div class="row row-cols-lg-2"><div>

In CTFs, you will most of the time be able to get a remote shell access to the target, similarily to a SSH access. There is a need for a 

* **server** which is accepting connections <small>(most likely the hacker host)</small> 
* **client** which is connecting to the server <small>(most likely the victim)</small>

There are 3 kind of ways to get a remote shell:

* [Web shell](shell/web_shell.md)
* [Reverse shell](shell/reverse_shell.md)
* [Bind shell](shell/bind_shell.md)

➡️ To avoid alerting IDS, a bind/reverse shell should use a protocol that would not be suspected such as HTTPS (`443`). 

☠️ Most of the time, bind/reverse shells are blocked by firewalls.

🐸 See [msfvenom](shell/tools/msfvenom.md) to generate shells, and [msfconsole](/cybersecurity/red-team/tools/frameworks/metasploit/_files/msf_handler.md) to catch them.
</div><div>

Most remote shells that we create are instable:

* 😥 you can't use commands requiring user input <small>(ex: `sudo`)</small>
* 🍃 You can't clear nor resize your terminal
* 🦥 There is no auto-completion, you can't use arrows...
* ⛔ CTRL+C kill the shell, not the command

We can use a wrapper for the client/server <small>(the one on your machine)</small> to make things really nice, or we can [try to manually patch the shell](shell/manual.md).

* [Penelope wrapper](shell/tools/penelope.md)
* [pwncat wrapper](shell/tools/pwncat.md)
* [rlwrap wrapper](shell/tools/rlwrap.md)
* [socat wrapper](shell/tools/socat.md)

Not every shell can be upgraded <small>(test another client...)</small>. A wrapper, may be available both as client or server depending on what you do.
</div></div>

<hr class="sep-both">

## Vulnerability databases

<div class="row row-cols-md-2 mt-4"><div>

#### Vulnerabilities identifiers

To identify and classify vulnerabilities, you can use:

* 📌 **CVE** <small>(Common Vulnerabilities and Exposures)</small> is a dictionary of every known vulnerability. The format is **CVE-YEAR-ID**.

* 📝 **CWE** <small>(Common Weakness Enumeration)</small> is a list of common weaknesses in applications, grouped in categories.

* See also: [CAPEC](https://capec.mitre.org/), [ATT&CK](https://attack.mitre.org/tactics/enterprise/), CCE, CPE

<br>

#### Vulnerability scoring

There are 2 well-known systems to rank vulnerabilities.

* 🍀 **CVSS** <small>(Common Vulnerability Scoring System)</small> which was released in 2005, and is free and open-source. It calculated from 3 factors: Base, Temporal, and Environmental. Only the base is shown for a CVE. Use the [calculator](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator) to compute your company-specific value.

* 💵 **VPR** <small>(Vulnerability Priority Rating)</small> is a modern way based on the risk for the organization that uses it. It ranges from 0 to 100.

<br>

#### Proof Of Concept

When a vulnerability is discovered, a proof of concept (**PoC**) may be written to demonstrate that the vulnerability is exploitable. As a pentester, you may look for them to exploit a vulnerability.

➡️ Use GitHub, GitLab, and Google to look for them...
</div><div>

There are **many** vulnerability databases. You should use 2-3 as they may have different information <small>(community info, list of exploits...)</small>.

* [**Exploit DB**](db/exploit_db.md) - CVE with exploits
* [Attacker KB](db/attacker_kb.md) - community reviews
* [**CVE details**](db/cve_details.md) - every CVE
* [CVE.ORG (MITRE)](db/cve_org.md) - every CVE
* [Snyk](db/snyk.md) - focus on web applications
* [Rapid7](db/rapid7.md) - a bit of focus on metasploit
* [Circl](db/circl.md) - simplified information for each CVE
* [**NVD**](db/nvd.md) - NIST vulnerability database (NVD)
* [MSRC](db/msrc.md) - Microsoft CVEs
* [vulners](db/vulners.md) - Vulnerabilty search engine
* [Trickest/CVE](db/trickest_cve.md) - CVE + PoC
* [CVEList](db/cvelist.md) - GIT with every CVE
* [InTheWild](db/inthewild.md) - CVE used in the "wild"
* [cxsecurity](https://cxsecurity.com/) - CVE with exploits
* [packetstormsecurity](https://packetstormsecurity.com/files/tags/exploit/) - CVE with exploits
* [GitHub Advisory Database](https://github.com/advisories) - GitHub CVE Database
* [vulnerability-lab](https://www.vulnerability-lab.com/) - Vulnerability Labs List of CVEs
* [0day.today](https://www.0day.today/) - find or purchase exploits 💵
* [opencve](https://www.opencve.io/welcome) - CVE database aggregator

</div></div>

<hr class="sep-both">

## Common vulnerabilities 🪦

<div class="row row-cols-md-2 mt-4"><div>

Websites 🌍

* [Cross-site Scripting](vulns/web/xss.md) (XSS)
* [Cross-Site Request Forgery](vulns/web/csrf.md) (CSRF)
* [Server-Site Request Forgery](vulns/web/ssrf.md) (SSRF)
* [Command injection](vulns/injection/command.md)
* [Path traversal](vulns/web/traversal.md)
* [File inclusion](vulns/web/inclusion.md) (LFI/RFI)
* [Open Redirect](vulns/web/open_redirect.md)
* [Framework exploitation](techniques/framework.md)
* [File upload](vulns/web/file_upload.md)
* [Remote Code Injection](vulns/injection/rci.md) (RCI)

Databases 💰

* [SQL injection](vulns/injection/sql.md) (SQLi)
* SQL truncation
* KeePass (KbDx)
</div><div>

Serialization 🧪

* [XML External Entity](vulns/serialization/xxe.md) (XXE)
* [Insecure Deserialization](vulns/serialization/insecure.md)
* Recursive Regular Expression DoS

Memory 🥔

* [Video Game Cheating](techniques/cheating.md)
* Memory leaks
* Buffer Overflow
* Race condition
</div></div>

<hr class="sep-both">

## Common Failures

<div class="row row-cols-lg-2"><div>

**Identification and Authentication Failure** 🔑

* The website does not prevent brute force
* The website allows users to use weak passwords
* The website does not encrypt passwords

<br>

**Broken Access Control** 📭 <small>(users can access files/URLs they shouldn't)</small>

* The principle of the least privilege is not applied correctly
* Someone can use someone else token/ID to do something
* A user can access "logged-only" pages/features without logging in
</div><div>

**Injections** 🪤

* There is insufficient or no validation at all
* There is insufficient or no sanitization at all

<p>&nbsp;</p>

**Cryptographic Failures** 🔓

* The server is using clear text
* The server allows/uses HTTP instead of HTTPS
* The server uses a weak cryptographic algorithm
</div></div>

<hr class="sep-both">

## 👻 To-do 👻

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

Websites

* Server-Side Template Injection
* Same-Site Attacks: [CanITakeYourSubDomain](https://canitakeyoursubdomain.name/)
* [Session_fixation](https://en.wikipedia.org/wiki/Session_fixation)
* [HTTP Header Injection](https://en.wikipedia.org/wiki/HTTP_header_injection)
* [JWT](https://jwt.io/), (Bearer, encrypted token), modern alternative to (apache) HTTP basic auth? (from=35). HTB/170. [RFC](https://tools.ietf.org/html/rfc7617).
</div><div>
</div></div>