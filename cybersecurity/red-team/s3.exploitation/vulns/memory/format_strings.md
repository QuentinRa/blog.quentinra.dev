# Format Strings

<div class="row row-cols-lg-2"><div>

Format Strings is a bug in which user input is passed to a formatting function such as `printf` or `scanf` as the input format.

```c
printf(format, user_input); // not vulnerable
printf(user_input);         // vulnerable
```

üìö They could allow a malicious user to read/write variables, which may lead to sensitive data exposure.
</div><div>

ü™¶ Format String bugs are uncommon nowadays, mostly due to compilers notifying the developer.
</div></div>

<hr class="sep-both">

## C printf function

<div class="row row-cols-lg-2"><div>

When a function is called, its parameters are stored in memory at a location called the stack. Given `printf("%s", str)`:

* ...
* `0x00002`: address of the `"%s"` string parameter
* `0x00003`: address of the `str` string parameter
* ...

The `printf` function is a variadic function. It will know how many parameters it has from the format string <small>(e.g., `%s`=>`n=1`)</small>.

‚úçÔ∏è If we have the following code: `printf("%s")`, the function will still try to read one string from the stack, which may crash the program.
</div><div>

We can use that to read arbitrary values. Refer to [C Types](/programming-languages/low-level/c/general/index.md#types).

* `%c`: arbitrary read a char
* `%s`: arbitrary read a string
* `%x`: arbitrary read an integer and display it as hexadecimal
* `%x`: 

üìö To read the n-th parameter that is a char `%c`, we would use: `%n$c`.

ü§ñ <code>for i in `seq 1 1000`; do ./example "%$i\$s" 2> /dev/null | grep -v "Segmentation fault"; done</code>.
</div></div>

<hr class="sep-both">

## Python format() function

[![python_format_string](../../../../_badges/hacktricks/generic_methodologies_and_resources/python/bypass_python_sandboxes/python_format_string.svg)](https://book.hacktricks.xyz/generic-methodologies-and-resources/python/bypass-python-sandboxes#python-format-string)
[![python_format_string](../../../../_badges/rootme/app_script/python_format_string.svg)](https://www.root-me.org/en/Challenges/App-Script/Python-format-string)

<div class="row row-cols-lg-2"><div>

The python format function may be exploited to access variables from the code and display them. In the example below, we access the method `__init__` while any methods of the class would work. We can then relatively access other members of the class, or move up and access members of the parent `global` namespace.

```py
class X:
   pass
       
instance = X()
"{x.__init__}".format(x=x)
"{x.__init__.__globals__}".format(x=x)
"{x.__init__.__globals__[X]}".format(x=x)
"{x.__init__.__globals__[X][index]}".format(x=x) # one by one
```
</div><div>

We can alternatively use error messages.

* Since Python `3.10`, an additional message body was added when using an invalid string after "`:`".

```py
>>> "{x:toto}".format(x=5)
# ValueError: Invalid format specifier 'toto' for object of type 'int'
```

* For every version of python, an exception is raised when we use an unknown format code <small>(e.g. `s` for string, as in "%s")</small>.

```py
>>> "{x:s}".format(x=5)
# ValueError: Unknown format code 's' for object of type 'int'
```
</div></div>