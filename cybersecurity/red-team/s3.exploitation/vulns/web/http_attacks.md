# HTTP Requests

There are multiple ways to abuse HTTP requests.

<div class="row row-cols-lg-2"><div>

#### HTTP CRLF Attack

[![crlf](../../../../_badges/hacktricks/crlf.svg)](https://book.hacktricks.xyz/pentesting-web/crlf-0d-0a)
[![crlf](../../../../_badges/rootme/web_server/crlf.svg)](https://www.root-me.org/en/Challenges/Web-Server/CRLF)

[CRLF Injection](https://en.wikipedia.org/wiki/HTTP_response_splitting) can be used for request smuggling or log corruption. For instance, it may be used to  insert malicious logs.
</div><div>

#### HTTP Request Smuggling

[![httprequestsmuggling](../../../../_badges/thm/httprequestsmuggling.svg)](https://tryhackme.com/r/room/httprequestsmuggling)

Request Smuggling occurs request that is interpreted as two by the back-end while load-balancers/reverse proxies only saw one request.

When both `Content-Length` <small>(CL)</small> and `Transfer-Encoding` <small>(TE)</small> are present, each solution may differently interpret the size of the request.

ðŸ“š Usage: evade firewalls, cache poisoning, etc.

<details class="details-n">
<summary>HTTP Response Size</summary>

* `Content-Length`: size of the request in bytes
* `Transfer-Encoding: chunked`: request split in chunks

```text!
...
Transfer-Encoding: chunked
    
e              // size of data
Hello, World!  // data (13+1 bytes for \n)
0              // end
```
</details>

* **CL.TE**: use `Content-Length` with first chunk 0
* **TE.CL**: use `Content-Length: (n+2)` with `n` the size in bytes of the chunk. No need to TE in the request in the chunk.
* **TE.TE**: try TE header twice and use an invalid header value like `Transfer-Encoding: chunked1` for the second. Maybe the first intermediary will ignore it while the second would fall back to CL.
* **CL.CL**: try using two CL with first size 0 

ðŸ“š For old ATS servers, `\0` in header-value or long header values <small>(65536+)</small> may do the trick too.

ðŸ“š ATS uses CL <small>(ðŸ‘»)</small>. Nginx uses TE <small>(ðŸ‘»)</small>.
</div></div>

<hr class="sep-both">

## ðŸ‘» To-do ðŸ‘»

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

* [HTTP Header Injection](https://en.wikipedia.org/wiki/HTTP_header_injection)

```ps
$ nc -q 1 IP PORT <<< cat request.txt
$ zaproxy # but uncheck options "fixing" the request
```
</div><div>
</div></div>