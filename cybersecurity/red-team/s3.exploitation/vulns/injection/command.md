# Command injection

[Go back](../../index.md)

[![oscommandinjection](../../../../_badges/thmp/oscommandinjection.svg)](https://tryhackme.com/room/oscommandinjection)
[![owasptop10](../../../../_badges/thm/owasptop10.svg)](https://tryhackme.com/room/owasptop10)
[![command_injection](../../../../_badges/poat/command_injection.svg)](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection)
[![picklerick](../../../../_badges/thm-p/picklerick.svg)](https://tryhackme.com/room/picklerick)
[![ignite](../../../../_badges/thm-p/ignite.svg)](https://tryhackme.com/room/ignite)
[![commandinjections](../../../../_badges/htb/commandinjections.svg)](https://academy.hackthebox.com/course/preview/command-injections)

<div class="row row-cols-md-2"><div>

A command injection occurs when a developer uses the user input in system commands without proper sanitization/measures.

For instance, a PHP website on Linux might use `grep`, `sed`, or other utilities instead of PHP functions for some operations:

```php!
$search = $_GET['q'];
$res = system("grep \"$search\" content/");
echo "<pre>$res</pre>";
```

With the following payload for `q`: `" -V; cat /etc/passwd #`, the command executed will be as follows, allowing us to steal /etc/passwd

```bash!
grep "" -V; cat /etc/passwd # content/
```
</div><div>

There are two kinds of command injections

* **Regular/in-band**: same channel to attack and gather results
* **Blind/out-band**: different channels to attack and gather results
    * Using redirections/flags, create a URL-accessible output file

```bash!
[...] cat /etc/passwd > /var/www/html/output.txt [...]
```

<ul>

* Using commands such as `sleep` to perform a time-based attack

</ul>

```bash!
[...] true && sleep 5 [...]
```
</div></div>

<hr class="sep-both">

## Bypass filters

<div class="row row-cols-lg-2"><div>

#### Character Filtering 

By-pass **space** character filtering.

* Try using tabs (`%09`)
* Try using variables (`${IFS}`)
* Try using brace expansion (`{ls,-la}`) (Bash)
* ...

By-pass **slash** character filtering.

* Try using variables (`${PATH:0:1}`)
* Try using variables (`${HOME:0:1}`)
* Try using variables (`${PWD:0:1}`) -- best
* Try using brace expansion (`{ls,-la}`) (Bash)
* ...

‚û°Ô∏è See also: `printenv` or `env` to list exploitable variables.
</div><div>

#### Command Filtering

Put pair of quotes/double quotes anywhere within the command

```ps
# available on Linux, Windows (PowerShell)
$ w'ho'ami ; w""hoam''i
```

* Put `\\` or `$@` anywhere within the command

```ps
# available on Linux
$ w\ho\am\i ; who$@ami
```

* Put `^` anywhere within the command

```ps
# available on Windows (CMD)
CMD> who^am^i
```

* Reverse commands

```ps
$ $(rev<<<'imaohw')
PS> iex "$('imaohw'[-1..-20] -join '')"
```
</div></div>

<hr class="sep-both">

## üëª To-do üëª

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

* Windows Slash (`$env:HOMEPATH[0]`)
* WAFs
</div><div>
</div></div>