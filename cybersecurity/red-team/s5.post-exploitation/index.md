# Final step - Post-exploitation

<div class="row row-cols-lg-2"><div>

Post-exploitation ✈️ is the last step of the pentester activities. Once we got access to the target, and escalated to administrator, we are trying to **maintain** and **expand** our access to other machines.

Pivoting to another victim is called **lateral movement** 🔓. Target high-value hosts such as SQL or Microsoft Exchange servers.
</div><div>

**Common activities** 🤖

* 🚪 Leave a backdoor (persistence)
* 🙊 Deface the public website
* 🕸️ Redirect users to a malicious website/server
* 💰 Stealing data <small>(files, photos, emails, source code...)</small>
* 🔑 Stealing credentials <small>(authentication tokens, password, keepass)</small>
* 🌋 Mess with timestamp/... to complicate forensics
* 🧹 Cleanup logs
* ⌨️ installing keyloggers
* 🧨 Edit software configurations/users permissions
* 🐲 Reset user passwords to access their account
</div></div>

<hr class="sep-both">

## Windows Post-exploitation

<div class="row row-cols-lg-2"><div>

#### 💰 Stealing data/credentials on Windows 🔑

You can hunt for more [secrets](/cybersecurity/red-team/s4.privesc/index.md#credential-hunting) now that you have more privileges, but the process is the same.

You can refer to [Windows Pentester Notes](/operating-systems/windows/security/index.md#windows-pentester-notes-) to dump the the SAM database, DPAPI keys, Kerberos tickets, etc.

📚 As administrator, use `HKEY_USERS` instead of `HKEY_CURRENT_USER`.

<br>

#### 🚪 Leave a backdoor on Windows

[![adventofcyber2](../../_badges/thm/adventofcyber2/day11.svg)](https://tryhackme.com/room/adventofcyber2)

Create a new local user.

```ps
PS> net user <username> <password> /add
```

Add a user in the local administrator group.

```ps
PS> net localgroup administrators <username> /add
```

Add a user in the domain admins group.

```ps
PS> net group "domain admins" <username> /add /domain
```
</div><div>

#### 🧨 Windows Edit software configurations

[![windows_privilege_escalation](../../_badges/htb/windows_privilege_escalation.svg)](https://academy.hackthebox.com/course/preview/windows-privilege-escalation)

On hosts connected to active directory, folders such as `%APPDATA%` are shared between machines. If we add a program in `USERPROFILE\AppData\Microsoft\Windows\Start Menu\Programs\Startup`, then it will be executed when the users log in.

#### 🔓 Lateral Movement - Administrator Password Reuse

[![active_directory_enumeration_attacks](../../_badges/htb/active_directory_enumeration_attacks.svg)](https://academy.hackthebox.com/course/preview/active-directory-enumeration--attacks)

We can use [crackmapexec](/cybersecurity/red-team/tools/cracking/auth/cme.md)/[nxc](/cybersecurity/red-team/tools/cracking/auth/nxc.md) to test the administrator hash or password on many hosts.

```ps
$ nxc smb --local-auth CIDR -u administrator -H hash
```

If LAPS was implemented, refer to [LAPS](/operating-systems/windows/security/index.md#microsoft-local-administrator-password-solution-laps).

#### 🔓 Lateral Movement - Find Interesting Users/Groups

Refer to [LDAP](/operating-systems/networking/protocols/ldap.md).

#### 🔓 Lateral Movement - Golden/Silver Ticket

[![golden_ticket](../../_badges/hacktricks/windows_hardening/active_directory_methodology/golden_ticket.svg)](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/golden-ticket)
[![silver_ticket](../../_badges/hacktricks/windows_hardening/active_directory_methodology/silver_ticket.svg)](https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/silver-ticket)

A golden ticket is a forged ticket (TGT) created using the KRBTGT account NTLM password hash, and the information we want <small>(ex: expire in 10 years, associated with account XXX even if disabled/deleted, etc.)</small>.

A silver ticket is a forget ticket (TGS) created using the target service account password hash. It's similar to a golden ticket aside from the fact that it only grants access to one service.
</div></div>

<hr class="sep-both">

## 👻 To-do 👻

Stuff that I found, but never read/used yet.

<div class="row row-cols-lg-2"><div>

Windows

* See also VSS

Linux

* 🚪 You can give capabilities to a file with `setcap`
* SSH key
</div><div>

* Passive attacks (monitor)
* Active attacks
* Meterpreter
* /.dockerenv (check if we are in a docker)
* KeePass (see exploitation note too?)
* Vulnerable security questions (unencrypted, easy to guess, reset passwords)
* Pass-The-Hash Attack
* rootkit, bootkit
* Credential dumping
* Forensics: clear PowerShell history
</div></div>