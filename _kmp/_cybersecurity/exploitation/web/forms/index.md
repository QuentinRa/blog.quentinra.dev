# Forms

<div class="row row-cols-md-2"><div>

Most websites are using a lot of forms

* Login
* Update user information
* Search something
* Upload a file
* Request/Send some data to an API
* ...

The two most well-known forms are **GET** and **POST** forms. They are similar in every way, aside from the way they are sending data and their semantics.
</div><div>

Unfortunately, these forms are also vectors of attack if the data received isn't properly handled server-side.

* SQLi injections <small>(ex: execute SQL code on the target)</small>
* Remote Code/Command Execution (RCE)
  * Command injection <small>(ex: run a command on the target)</small>
  * Code injection <small>(ex: upload and run a PHP script on the target)</small>
* File inclusion <small>(ex: access files/include a malicious script)</small>
* Server-Side Request Forgery <small>(ex: use the server to query another server)</small>
* XSS injections <small>(ex: inject code executed by other users or the staff)</small>
* ...
</div></div>

<hr class="sep-both">

### HTML forms

<div class="row row-cols-md-2"><div>

Before continuing, it's important to note that a form is something like this. There are a bunch of input fields <small>(not necessarily `<input>`)</small> that may not even be inside the `form` tag. Some may be hidden, but regardless of being shown/hidden, only fields that have a **name** will be sent to the server, along with their value.

```html
<!-- data will be sent to /handle_form.php -->
<form method="post" action="/handle_form.php" id="example">
  <input type="text" name="name" value="toto">
  <input type="text" name="password" value="ToTo">
  <input type="text" name="secret" value="007" hidden>
  <input type="text" value="not send">
</form>
<input type="text" name="external" value="0" form="example" hidden>
```
</div><div>

It will generate the following request with name and value joined with equals (`=`), and pairs separated with an ampersand (`&`).

```http request
POST /handle_form.php HTTP/1.1

name=toto&password=ToTo&secret=007&external=0
```
</div></div>

<hr class="sep-both">

### URL encoding

<div class="row row-cols-md-2"><div>

Not every value can send used as a value inside a request. For instance, characters such as `'` (single quote), whitespace... must be encoded. We call this encoding **URL encoding** and this is a  process automatically done by your browser.
</div><div>

Basically, the hexadecimal value of the ASCII for `'` is `27`, so the URL encoding will be `%27`, as simple as that.

* See [URL encoder](https://www.urlencoder.io/)
* See [ASCII Code](https://www.ascii-code.com/)
</div></div>

<hr class="sep-both">

## GET forms

<div class="row row-cols-md-2"><div class="align-self-center">

In a GET form, the data is sent in the URL, and we call it a **query**. Ex:

```
https://www.google.com/search?q=hello%20world
```

which is matching the input field below

```html
<input name="q" type="text" value="hello world" [...]>
```

</div><div>

üìÉ Basically, in a search form, by default, if you didn't search anything, the page is just showing a page with the search bar. But, once you search for something, the page will also list results.

If you press F5/reload the page, you will still see your page with results, as the request has generated a URL with the query inside.

üìù The [HTTP method GET](/_it/networking/protocols/index.md#-http---80-tcp) is intended to be used by forms leading to a page that will display itself according to what the user submitted.
</div></div>

<hr class="sep-both">

## POST forms

<div class="row row-cols-md-2"><div>

POST is used by forms that will change something on the server, such as to create, update, and delete resources. The difference with GET Forms is that the data is sent in the body of the request, so you won't see your credentials in your URL üîê. Some use cases are

* Login forms
* Update user information
* Upload a file
</div><div>

Example of a simple POST request

```http request
POST https://example.com/login.php HTTP/1.1

username=toto&password=ToTo
```
</div></div>

<hr class="sep-both">

## Forms in PHP

<div class="row row-cols-md-2"><div>

When forms are received by a PHP script, parameters are automatically stored inside the variable **$\_POST** for POST forms and respectively **$\_GET** for GET forms.

```php
<?php
// if there is a GET parameter q
if (isset($_GET['q'])) {
    // then do something using it
    echo "Query parameter p is: '$_GET[q]'.";
} else {
    // else execute the usual code
    echo "No query.";
}
```

There is also a variable **\$\_REQUEST** which contains both values in \\$\_GET, and values in \\$\_POST. If a value is both in \\$\_POST, AND \\$\_GET, then **only the value in \\$\_POST will be kept**.

> **Note**: to be fair, `$_REQUEST` may also have the values inside `$_COOKIES`, values which are overriding values in `$_POST`. It's disabled by default, due to security concerns.
</div><div>

[![authenticationbypass](../../../_badges/thmp/authenticationbypass.svg)](https://tryhackme.com/room/authenticationbypass)

**Some logic flaws when using $\_REQUEST**

* a developer might use `$_REQUEST` for a GET form. Let's say that the developer sanitized/ensured that the value in `$_GET` is clean, then we can bypass the check by sending both data in `$_GET` and `$_POST`.

```bash
$ curl 'URL?param=value' -d 'param=value2'
# the dev filters $_GET['param']
# but $_REQUEST['param'] will be 'value2'
# so, if dev developer uses it => a logic flaw
```

* it's possible that a developer is using a GET form, then a POST form. In such a scenario, the developer may use `$_REQUEST` to fetch values. If the dev checked the data at step1, but not at step 2, we may be able to bypass the check in step 1.

```bash
$ curl 'URL/step1?param=value'
# the dev checks the value for param
# if ok, we can go to step2
# now, the dev may "trust" param to be valid
$ curl 'URL/step2?param=verified' -d 'param2=value2&param=value3'
# now, the dev filter $_POST['param2']
# but, we override param value, so
# $_REQUEST['param'] is 'value3' which hasn't been filtered
# if the dev uses it => a logic flaw
```
</div></div>