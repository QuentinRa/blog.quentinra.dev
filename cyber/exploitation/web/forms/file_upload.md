# File upload

[![uploadvulns](../../../_badges/thmp/uploadvulns.svg)](https://tryhackme.com/room/uploadvulns)

<div class="row row-cols-md-2"><div>

It's common for websites to allow users to upload files such as an avatar. In some cases unfortunately, a hacker can upload malicious files such as a script leading to **Remote Code Execution** (RCE); which also mean Remote Command Execution.

Usually, most website have filters, but they are often logic flaws in the filtering, leading to malicious files passing them.
</div><div>

**Impact ðŸ’¥**: the hacker can upload a webshell or a reverse shell, and may take full control of the machine using privilege escalation.

**Vectors**: Forms.
</div></div>

<hr class="sep-both">

## Process

<div class="row row-cols-md-2"><div>

...
</div><div>

**Remediation** ðŸ§¯

* Do not use a well-known name for your uploads (`uploads`, `images`...)

* Disable indexing

* Do not expose uploaded files if there is no reason for them to be available to the user. You could also restrict access with a `.htaccess` only allowing the local website to access them.
</div></div>

<hr class="sep-both">

## Bypassing File Upload filters

<div class="row row-cols-md-2 mt-4"><div>

* bypass check of the extension being in the filename

```
malicious.png.php
```

* bypass blacklists/deny list

```
malicious.png.PHP // may not work
malicious.png.pHp // may not work
malicious.png.php5
malicious.png.php7
malicious.png.phtml
```
</div><div>

* Manually edit the MIME type

```
MIME-type: application/php -> image/png
```

* Try the null byte <small>(PHP < 5.3.4)</small>

```
malicious.php%00.png -> malicious.php
```
</div></div>