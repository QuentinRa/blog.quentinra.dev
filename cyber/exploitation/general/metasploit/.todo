db_vulns

https://www.tunnelsup.com/metasploit-cheat-sheet/

Metasploit has a number of modules to scan open ports on the target system and network.
You can list potential port scanning modules available using the `search portscan`

* `auxiliary/scanner/portscan/tcp` (TCP port scan)
* `scanner/discovery/udp_sweep` (UDP services)
* `auxiliary/scanner/smb/smb_version` (SMB Scans)
* `auxiliary/scanner/http/http_version` (HTTP version)
* `auxiliary/scanner/smb/smb_login`: bruteforce SMB
* you can write "use xxx" if there is only one xxx

----

Note that choosing a working payload could become a trial and error process due to environmental or OS restrictions
such as firewall rules, anti-virus, file writing, or the program performing the payload execution
isn't available (eg. payload/python/shell_reverse_tcp).

```
> bg
# must be root
> use post/linux/gather/hashdump
> set SESSION 1
> run
```

<hr class="sep-both">

# Meterpreter2

https://tryhackme.com/room/meterpreter

* Notes about the meterpreter
* getpid
* `tasklist /m /fi "pid eq 1304"`
* inline (also called single) and staged
  * staged payloads are sent to the target in two steps
  * An initial part is installed (the stager) and requests the rest of the payload
  * This allows for a smaller initial payload size. The inline payloads are sent in a single step.
* `msfvenom --list payloads | grep meterpreter`: you need to pick one based on the OS, the availability of the component (python/php...), and the kind of connection allowed. Some exploits have a default Meterpreter payload see `show payloads`.
* `help` (Windows version of Meterpreter windows/x64/meterpreter/reverse_tcp)
* https://tryhackme.com/room/meterpreter list of commands
* Remember to check all available commands running the help command once a Meterpreter session has started
* Be careful; you may lose your user privileges if you migrate from a higher privileged (e.g. SYSTEM) user to a process started by a lower privileged user (e.g. webserver). You may not be able to gain them back.
* These hashes can also be used in Pass-the-Hash attacks to authenticate to other systems that these users can access the same network.
* load command to leverage additional tools such as Kiwi or even the whole Python language
* Gathering further information about the target system.
  Looking for interesting files, user credentials, additional network interfaces, and generally interesting information on the target system.
  Privilege escalation.
  Lateral movement.
* SMB with credentials `using exploit/windows/smb/psexec`
* post/windows/gather/enum_domain (target domain, can use sysinfo?)
* `migrate -N spoolsv.exe` (printer service)

----------

------
Payloads stagged/...
------

<details class="details-e">
<summary>Note: Windows defender</summary>

It's highly likely that the machine is running Windows defender. You may try to use others payloads, such as `exploit/multi/script/web_delivery`.

* set the target (ex: powershell)
* ...
* run
* paste the prompt in the terminal you want to exploit
* done?
</details>