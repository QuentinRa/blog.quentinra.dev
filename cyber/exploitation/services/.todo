<hr class="sep-both">

## Network & protocols

--- https://tryhackme.com/room/networkservices

* https://www.jscape.com/blog/countering-packet-sniffers-using-encrypted-ftp
* https://gregit.medium.com/exploiting-simple-network-services-in-ctfs-ec8735be5eef
* https://attack.mitre.org/techniques/T1210/
* https://www.nextgov.com/cybersecurity/2019/10/nsa-warns-vulnerabilities-multiple-vpn-services/160456/

--- https://tryhackme.com/room/networkservices2

* NFS stands for "Network File System"
* Mount remote repository on local host
* RPC is used for exchanges with the server
* transfer files between computers running Windows and other non-Windows operating systems, and vice-versa
* sudo apt install nfs-common
* see mounts: `showmount -e 10.10.72.134`
* sudo mount -t nfs IP:/share /tmp/mount/ -nolock (not to use NLM locking)
* chmod 600 id_rsa
* if root_squashing enabled
  * remote: cp /bin/bash /share/sbash
  * local
    * sudo chown root /tmp/mount/sbash
    * sudo chmod +s /tmp/mount/sbash
  * remote: /share/sbash -p
* sudo umount /tmp/mount
* port 2049
* nfs-showmount (nmap)
* SMTP send back the email if it couldn't be sent
* Metasploit: smtp_version
* The SMTP service has two internal commands that allow the enumeration of users: VRFY (confirming the names of valid users) and EXPN (which reveals the actual address of userâ€™s aliases and lists of e-mail (mailing lists)
* auxiliary/scanner/smtp/smtp_version
* auxiliary/scanner/smtp/smtp_enum
* sudo nmap 10.10.200.26 -p25 --script "*smtp*"
* https://www.kali.org/tools/smtp-user-enum/
* sudo apt install default-mysql-client
* mysql-enum (nmap)
* 3306
* mysql_sql: send SQL queries...
* auxiliary/scanner/mysql/mysql_schemadump (dump cols+tables)
* use xxx
* auxiliary/scanner/mysql/mysql_hashdump
* get users + hash
* password reuse

<hr class="sep-both">

<hr class="sep-both">

# xxx

Sending a mail involves a Mail Submission Agent (MSA) to send the mails to someone who can send it, a Mail Transfer Agent, which will send it to the Mail Delivery Agent, that will achieve it to the other Mail User Agent. MTA+MTA is common.

* Simple Mail Transfer Protocol (SMTP): use plaintext. port 25.
  * helo hostname
  * mail from:
  * rcpt to:
  * data
    * subject:
    * <CR>.<CR>
* POP3/IMAP are protocols to download mails from a MDA
  * Post Office Protocol version 3 (POP3, 110): USER/PASS to the server. STAT to find the number of mails, and the size of the mailbox. LIST to list new messages. RETR 1 to retrieve the "1rst" one. plaintext. Email is deleted once downloaded (default), but you would lose track or read/unread.
  * Internet Message Access Protocol (IMAP) - 143: LOGIN username password. Synchronisation: if you read something, then the status is updated on the server.
    * c1 LIST "" "*" (list emails in any folder)
    * c2 EXAMINE INBOX
    * c3 LOGOUT
    * Send as clear text

Servers implementing these protocols are subject to different kinds of attacks. To name a few, consider:

* Sniffing Attack (Network Packet Capture)
  * using a network packet capture tool to collect information about the target
  * Tcpdump is a free open source command-line interface (CLI) program that has been ported to work on many operating systems.
  * Wireshark is a free open source graphical user interface (GUI) program available for several operating systems, including Linux, macOS and MS Windows.
  * Tshark is a CLI alternative to Wireshark.
  * Before explaining this command, we should mention that this attack requires access to the network traffic, for example, via a wiretap or a switch with port mirroring. Alternatively, we can access the traffic exchanged if we launch a successful Man-in-the-Middle (MITM) attack.
  * `sudo tcpdump port 110 -A` (only port 110=POP3, and ASCII)
  * Wireshark: enter "pop" > same result but nicer
  * TLS have been added to HTTP, FTP, SMTP, POP3, and IMAP
* Man-in-the-Middle (MITM) Attack
  * A Man-in-the-Middle (MITM) attack occurs when a victim (A) believes they are communicating with a legitimate destination (B) but is unknowingly communicating with an attacker (E).
  * The attacker can modify the information send by the client, or sniff packets. It depends of the integrity checks/security of the protocol.
  * https://www.ettercap-project.org/
  * https://www.bettercap.org/
  * The solution lies in proper authentication along with encryption or signing of the exchanged messages. With the help of Public Key Infrastructure (PKI) and trusted root certificates, Transport Layer Security (TLS) protects from MITM attacks.
* SSL (Secure Sockets Layer) then TLS (more secure).
  * HTTPS: 443
  * FTPS: 990
  * SMTPS: 465
  * POP3S: 995
  * IMAPS: 993
  * They add an additional step when connected with the server, which is establishing a SSL/TLS connection
    * SSL: ClientHello (indicate supported algorithms)
    * Exchanges information to create a maser key
    * The server reply that it will use encryption
  * DOT (DNS Over TLS)
* Password Attack (Authentication Attack)
  * hydra -d, for debugging
  * Mitigations: https://tryhackme.com/room/protocolsandservers2