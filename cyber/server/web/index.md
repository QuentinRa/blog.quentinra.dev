# Exploit a webserver

[![introwebapplicationsecurity](../../_badges/introwebapplicationsecurity.svg)](https://tryhackme.com/room/introwebapplicationsecurity)
[![contentdiscovery](../../_badges/contentdiscovery.svg)](https://tryhackme.com/room/contentdiscovery)
[![walkinganapplication](../../_badges/walkinganapplication.svg)](https://tryhackme.com/room/walkinganapplication)
[![httpindetail](../../_badges/httpindetail.svg)](https://tryhackme.com/room/httpindetail)

*According to TryHackMe, there are 4 categories of failures related to webservices.*

<div class="row row-cols-md-2"><div>

**Identification and Authentication Failure** üîë

* The website do not prevent bruteforce
* The website allows users to use weak passwords
* The website do not encrypt passwords
	
<br>

**Broken Access Control** üì≠ <small>(a hacker can access files/URLs we shouldn't)</small>

* The principle of the least privilege not applied correctly
* Someone can use someone else token/id to do...
* A user can access "logged-only" pages without logging in
</div><div>

**Injections** ü™§

* There is an insufficient, or no validation at all
* There is an insufficient, or no sanitization at all

<p>&nbsp;</p>

**Cryptographic Failures** üîì

* The server is using clear text
* The server allow/use HTTP instead of HTTPS
* The server use a weak cryptographic algorithm
</div></div>

<hr class="sl">

## Discovery of a website

*As a penetration tester, you will have to list every feature of the website. For instance, "list all products":`/products,` "list a product":`/products?id=x`. This is done as you explore by tools such as Burp.*

<div class="row row-cols-md-2"><div>

Try to view the source of the website

* hidden elements?
* HTML comments?
* framework / version?

Most developers are using a framework, which is a sort of box of utilities to make a website more easily.

* Look if the framework is credited at the bottom of the page
* Look if there is a comment with the framework name/... in the HTML
* Look for the default favicon of the framework. Usually, it's stored at `/favicon.ico`, although it's usually removed. If you do find one, download it, hash it (MD5), and [find it in OWASP favicon database](https://wiki.owasp.org/index.php/OWASP_favicon_database)

```bash
# Linux
curl url/favicon.ico | md5sum
# Windows (on a download favicon)
Get-FileHash .\favicon.ico -Algorithm MD5
```
</div><div>

**Analyse the network**

You may the dev console network tab to analyse requests, and responses send to the server. Once you click on a request, there are multiple tabs, for the request, the response...

Some misconfigured servers are for instance, sending the web service name <small>(nginx, apache)</small>, and sometimes even the version.

**Analyse the javascript**

You may use the dev console debugger, after adding a breakpoint in the JavaScript, to analyze the javascript code, if needed.

**/robots.txt and /sitemap.xml**

Robots.txt are listing pages that crawlers (search engine robots) shouldn't crawl. There may be some routes that even clients were not aware of inside. 

There is also a link to the website "sitemap", which is generated by the developer to help search engine index the website. If the sitemap wasn't updated, you may find interesting routes, meaning not available for the "usual" visitor, but that were available before, that were not removed, and that are maybe vulnerable.
</div></div>

<div class="row row-cols-md-2"><div>

**Tools**

[wappalyzer](https://github.com/wappalyzer/wappalyzer) (7.8k ‚≠ê) that can be installed as a browser extension, or via their [website](https://www.wappalyzer.com/). It can be used to find frameworks, their versions...
</div><div>

**Wayback machine**

You can look for old version of the website stored on the [Wayback](https://archive.org/web/) machine, if any. Google has also a feature to see cached versions of a website, but it's not very useful for this purpose.

**OSINT**

If the company tried to hire employees in the past, you may find information about the framework or stuff like this in the job offers.

If you can find employees on GitHub/..., you may find what language/frameworks they are using for their websites.

You may also look for personal websites/posts/interest of employees, because that may be an indicator too.
</div></div>

<hr class="sr">

## Frameworks

<div class="row row-cols-md-2"><div>

If you found a framework

* Look for a way to get the version (as a client, if any). For instance, the framework in a specific version, may use a specific version of a JavaScript/CSS library, if any. It may be a hint, trough it's not reliable.
* Look for common misconfiguration mistakes
* Look for vulnerabilities
* Look for the login page / CMS panel. 
  * Test default credentials
  * Test bruteforce password, with the default username
</div><div>

**WordPress** (not tested yet)

* Scan
  * [WPScan](https://github.com/wpscanteam/wpscan) (open-source)
  * [jetpack](https://jetpack.com/) (paid)
  * [WPScan](https://wpscan.com/) (cloud version, paid)
* Todo
  * [WordPress: THM WebEnumeration2](https://medium.com/@edwinngugi149/wordpress-hacking-tryhackme-write-up-1c895a1822b)
  * [Wordpress: THM Internals](https://medium.com/swlh/tryhackme-internal-walkthrough-fdc6c4b569bd)
</div></div>

<hr class="sl">

## Forced Browsing / Server enumeration

<div class="row row-cols-md-2"><div>

Forced browsing means using an automated tool in order to find hidden folders, and files. These files/folders are supposed to be unreadable, but sometimes they are not.

* configuration files (ex: .config)
* old files (ex: index.php.old)
* backup files (ex: xxx.bak, backup.xxx)
* admin/cms panels (ex: WordPress admin login page)
* private files (ex: documents...)

Most tools, namely **web scanners**, are taking

* **a URL**: `http://xxx.yyy`, `http://xxx.yyy:80`, `127.0.0.1`, `127.0.0.1:80`
* **a WordList**: on kali, use the command `wordlists` to find directories used to store wordlists. Alternatively, install the command `seclists` to have even more wordlists.
  * `/usr/share/wordlists/dirb/common.txt`
  * `/usr/share/wordlists/dirbuster/directory-list-2.3-small.txt`
  * ...
</div><div>

<details class="details-e">
<summary class="pb-2">GoBuster (6.7k ‚≠ê / Language: Go)</summary>

```bash
$ gobuster dir -u URL -w wordlist 
```

Using the following command, for every entry in the wordlist, a version with, and without each extension will be tested.

```bash
$ gobuster dir -u URL -w wordlist -w php
$ gobuster dir -u URL -w wordlist -w php,html
```

Other options

* `-U`: username
* `-P`: password
* `-p`: proxy
* `-p`: proxy
* `-c`: a cookie <small>(for instance, to simulated that we are logged)</small>
</details>

<details class="details-e">
<summary class="pb-2">dirsearch (8.7k ‚≠ê / Language: python)</summary>

You can install it with `apt install dirsearch`, and there is an implementation in GO if you want to.

```bash
# use default wordlist
$ dirsearch -u URL
$ dirsearch -u URL -w wordlist
```

Ignore some error codes

```bash
$ dirsearch -u URL -x 404
$ dirsearch -u URL -x 404,500
```

Using the following command, for every entry in the wordlist, a version with, and without each extension will be tested.

```bash
$ dirsearch -u URL -e php
$ dirsearch -u URL -e php,html
```
</details>

<details class="details-e">
<summary>ffuz (8k ‚≠ê / Language: Go / not primary purpose)</summary>

```bash
# will replace FUZZ with every entry in common.txt
$ ffuf -u URL/FUZZ -w wordlist
```
</details>

Other tools that you may see in use

* [feroxbuster](https://github.com/epi052/feroxbuster) (3.3k ‚≠ê, Rust)
* [dirb](https://dirb.sourceforge.net/) <small>(debian: `apt install dirb`)</small>
* [DirBuster](https://github.com/KajanM/DirBuster) (63 ‚≠ê)
</div></div>