# Notes

**offensive security**

Look for vulnerabilities, recommend patches. Exploiting bugs. Finding loopholes. Gain unauthorized access.

* **penetration tester**: "Responsible for testing technology products for finding exploitable security vulnerabilities." (web security, network security knowledge, use various programming languages, cloud security)
* **Red Teamer**: "Plays the role of an adversary, attacking an organization and providing feedback from an enemy's perspective."
* **Security Engineer**: "design, monitor, and maintain security controls, networks, and systems to help prevent cyberattacks".

**defensive Security**. 
  * **Security Analyst** (monitor - splunk?)
  * **Incident Responder** (impact? goal? what can they do? - Volatility?)
  * **malware analysis**

Detect, and stop attacks. Monitor, analyze. Investigate infected computers, try to find how they were hacked, track down cybercriminals.

* Linux security researcher > Hashing

<hr class="sep-both">

## Random

* Attack a vulnerable machine, scan the network to discover more vulnerable machines.

* find "password" in some conversations > try to get access to some stuff with it

* Intrusion Detection System (IDS) is a system that detects unauthorised network and system intrusions. Examples include detecting unauthorised devices connected to the local network and unauthorised users accessing a system or modifying a file.

<hr class="sep-both">

## Tools

* The [SecLists GitHub Repository](https://github.com/danielmiessler/SecLists/) contains useful lists of usernames/passwords, payloads, urls, ...

<hr class="sep-both">

## Linux

* python3 -m  http.server: start web server, was used to open a "root" file without perms
* `cron` process to schedule tasks, with `crontabs` (file)
  * ...
  * Automated tasks in Linux
  * https://crontab-generator.org/
  * https://crontab.guru/
  * edit `crontab -e`
* Logs
  * `/var/log`
    * ufw: firewall
    * apache
    * fail2ban

<hr class="sep-both">

## nmap

ARP scan: This scan uses ARP requests to discover live hosts

ICMP scan: This scan uses ICMP requests to identify live hosts

TCP/UDP ping scan: This scan sends packets to TCP ports and UDP ports to determine live hosts.

* `nmap -iL list.txt`
* `nmap -sL -n 10.10.12.13/29`
  * It will list each ip generated by the /29
  * So cool uwu, -n to not try reverse-DNS resolution
* `10.10.0-255.101-125`
* scanners not switches aya
* If sudo + local => ARP
* If sudo + outside:ICMP echo requests, TCP ACK (Acknowledge) to port 80, TCP SYN (Synchronize) to port 443, and ICMP timestamp request.
* When an unprivileged user tries to scan targets outside the local network, Nmap resorts to a TCP 3-way handshake by sending SYN packets to ports 80 and 443.
* sudo -PR: ARP scan
  * arp-scan --localnet or simply arp-scan -l
  * sudo arp-scan -I eth0 -l
* sudo -PE ( ICMP echo request)
* Because ICMP echo requests tend to be blocked, you might also consider ICMP Timestamp or ICMP Address Mask requests to tell if a system is online. Nmap uses timestamp request (ICMP Type 13) and checks whether it will get a Timestamp reply (ICMP Type 14). Adding the -PP option tells Nmap to use ICMP timestamp requests.
* Similarly, Nmap uses address mask queries (ICMP Type 17) and checks whether it gets an address mask reply (ICMP Type 18). This scan can be enabled with the option -PM.
* TCP SYN -> RST (Reset) if closed `-PS` (if root, reply with RST/ACK otherwise)
* TCP ACK -> send ACK reply? RST -PA
  * used to check if host is up, as RST is replied 'cause no connection
  * If you try it as an unprivileged user, Nmap will attempt a 3-way handshake.
* UDP sudo -PU
* -R, query DNS server even for offline hosts

Masscan

On a side note, Masscan uses a similar approach to discover the available systems. However, to finish its network scan quickly, Masscan is quite aggressive with the rate of packets it generates.

* There is summary: https://tryhackme.com/room/nmap01

<hr class="sep-both">

## Networking

* subnetting: use Network Address to split the network
  * is achieved by splitting up the number of hosts that can fit within the network, represented by a number called a subnet mask
  * 32 bits

a subnetwork is usually the equivalent of one or more network segments connected together and configured to use the same router. The network segment refers to a physical connection, while a subnetwork refers to a logical connection.

If you are in Network A, you can use ARP only to discover the devices within that subnet (10.1.100.0/24). Suppose you are connected to a subnet different from the subnet of the target system(s). In that case, all packets generated by your scanner will be routed via the default gateway (router) to reach the systems on another subnet; however, the ARP queries won’t be routed and hence cannot cross the subnet router. ARP is a link-layer protocol, and ARP packets are bound to their subnet.

It's beautiful how the gateway receiving the packet can also do ARP to find if the target is in the subnetwork.

ICMP from Network Layer

If you want to ping a system on the same subnet, an ARP query should precede the ICMP Echo.

ARP RESPONSE

* Local Area Network (LAN)
  * **Star Topology**: all devices are connected to a central networking device such as a switch or hub
  * **Bus Topology**: a single cable "backbone cable", all devices connect to the cable, too much packets: satured
  * **Ring/Token Topology**: each computer is connected to another forming a loop, data do the whole loop if needed, only one direction, not efficient, if hardware/cable is down/dead/fault network broken
  * **Switch**: aggregate multiples devices (4-64 ports), send packet to target because they know which target is on which of its ports
  * **Router**: connect networks, do "routing" (decide which route packets take)

* **DHCP**
  * IP adresses can be assigned manually
  * or most commonly by using a DHCP (Dynamic Host Configuration Protocol) server
  * If device connect, and has no IP
    * Send request to retrieve an IP: DHCP Discover
    * DHCP server replies if any, with an IP: DHCP Offer
    * The device confirm the IP: DHCP Request
    * The server ack: DHCP ACK
    * NOTE: ACK, REQUEST... are DHCP packets

<hr class="sep-both">

### Samba

"Samba is the standard Windows interoperability suite of programs for Linux and Unix. It allows end users to access and use files, printers and other commonly shared resources on a companies intranet or internet. It's often referred to as a network file system.

Samba is based on the common client/server protocol of Server Message Block (SMB). SMB is developed only for Windows, without Samba, other computer platforms would be isolated from Windows machines, even if they were part of the same network."

* Using nmap we can enumerate a machine for SMB shares:
  * port 445, and 139
  * `nmap -p 445 --script=smb-enum-shares.nse,smb-enum-users.nse <ip> -vv`
* `smbclient //<ip>/anonymous` login without password
* You may find useful information

<hr class="sep-both">

### Hashing

Asymmetric encryption - Uses different keys to encrypt and decrypt.

Cryptanalysis - Attacking cryptography by finding a weakness in the underlying maths

Passphrase - Separate to the key, a passphrase is similar to a password and used to protect a key.

Cryptography is used to 

* protect confidentiality (ssh tunnel)
* ensure integrity (checksum)
* ensure authenticity (certificate, signatures)

Any sensitive data stored must be encrypted.

https://www.pcisecuritystandards.org/documents/PCI_DSS_for_Large_Organizations_v1.pdf

* password are hashed, not encrypted

Python for crypto: integers are unlimited in size

* Symmetric encryption: tend to be faster, use smaller keys 128/256 AES
* Asymmetric encryption uses a pair of keys
  * Elliptic Curve Cryptography
  * RSA and Elliptic Curve cryptography are based around different mathematically difficult (intractable) problems, which give them their strength

> RSA typically uses 2048 to 4096 bits keys
> 
> RSA is based on the mathematically difficult problem of working out the factors of a large number.
> 
> CTF RSA https://github.com/RsaCtfTool/RsaCtfTool / https://github.com/ius/rsatool ?
> 
> https://muirlandoracle.co.uk/2020/01/29/rsa-encryption/

* exchanging keys
  * use public-private key to send the key
  * then use symmetric
  * In reality, you need to check authenticity
  * https://robertheaton.com/2014/03/27/how-does-https-actually-work/

* Signature
* Certificates
  * Root CA trusted by device -> chain of trust
  * Let’s Encrypt

SSH that use keys instead of login/pass. ssh-keygen, ssh-copy-id, or manually copying the key into authorized_keys with cat.

DHK

An excellent video if you want a visual explanation is available here. https://www.youtube.com/watch?v=NmM9HA2MQGI

DH Key Exchange is often used alongside RSA public key cryptography, to prove the identity of the person you’re talking to with digital signing. This prevents someone from attacking the connection with a man-in-the-middle attack by pretending to be Bob.

PGP?
PGP stands for Pretty Good Privacy. It’s a software that implements encryption for encrypting files, performing digital signing and more.

GnuPG or GPG is an Open Source implementation of PGP from the GNU project.

AES is complicated to explain, and doesn’t seem to come up as often. If you’d like to learn how it works, here’s an excellent video from Computerphile https://www.youtube.com/watch?v=O4xNJsjtN6E

The NSA recommends using RSA-3072 or better for asymmetric encryption and AES-256 or better for symmetric encryption.

https://doi.org/10.6028/NIST.IR.8105

* ssh2john

<hr class="sep-both">

## SQL

* service mysql start
* mysql -u root -p -h ip
* Type "source" followed by the filename of the mysql database to specify that you wish to view its database.
* `DESCRIBE [table name]`
* `source [sql filename]`: import. Don't write a path, move to the folder with the file.

<hr class="sep-both">

### Steganography

Hide things in images: [Steganography](https://0xrick.github.io/lists/stego/).

<hr class="sep-both">

### Search engines

Crawler/spiders are indexing websites. Follow URL by URL.

Search Engine Optimisation

* easy to crawl (sitemaps)
* keywords
* responsiveness

Robots.txt can be used to disallow robots from indexing pages. Maybe they add some config files (ini Windows, conf Linux).

**Google dorking**

* `"exact"`
* `site:domain`
* `filetype:pdf`
* `cache:domain`: cached version of URL
* `intitle:...`: must be in the title
* https://ahrefs.com/blog/google-advanced-search-operators/
* https://www.exploit-db.com/google-hacking-database

<hr class="sep-both">

### DNS

TLD

* gTLD (Generic Top Level)
* ccTLD (Country Code Top Level Domain)

Historically, gTLD were used to tell the purpose (.com=commercial), and ccTLD were used for geographical purposes.

Second-Level Domain: xxx.com, xxx is a SLD.
Subdomain: www

DNS records

* A = IPV4
* AAAA = IPV6
* CNAME Record: sort of "A" pointing to "B", so go ask the IP of "B"?
* MX Record = Mail server
* TXT Record = a lot of uses, such as to verify ownership of the domain name when signing up for third party services

A recursive server is provided by your ISP, you can pick your own. This server has a cache.

The authoritative server is often also known as the nameserver for the domain.

TTL is in seconds.

<hr class="sep-both">

### Websites

* Identification and Authentication Failure
  * Do not prevent bruteforce
  * Allow users to use weak passwords
  * Not encrypting passwords
* Broken Access Control (can access files/URLs we shouldn't)
  * principle of the least privilege not applied correctly
  * use someone token/id to view/edit/...
  * Access "authenticated-only" page without logging in
* Injection
  * validation
  * sanitization
* Cryptographic Failures
  * using clear text
  * HTTP instead of HTTPS
  * weak algorithm

BAC : Insecure Direct Object References (IDOR). Example is a server service resources, with a URL in which we can guess other files names.

<hr class="sep-both">

## Forensics

"You need to understand a website, to find weakness, and process hacking a website."

https://tryhackme.com/room/introdigitalforensics

Forensics is the application of science to investigate crimes and establish facts -> digital forensics. Digital forensics is used in two types of investigations:

* Public-sector investigations (gov, law enforcement)
* Private-sector investigations (hired by companies)

---------

pdfinfo DOCUMENT.pdf
sudo apt install poppler-utils
Open in edge -> details.

------

Images.

* Camera model / Smartphone model
* Date and time of image capture
* Photo settings such as focal length, aperture, shutter speed, and ISO settings
* GPS coordinates (if there is a GPS sensor)

exiftool. ExifTool is used to read and write metadata in various file types, such as JPEG images.

sudo apt install libimage-exiftool-perl

https://jimpl.com/
https://www.geekyhumans.com/tools/image-metadata-viewer

<hr class="sep-both">

## IPP - (TCP/631)

"The Internet Printing Protocol (IPP) - is a specialized Internet protocol for communication between client devices and printers. It allows clients to submit one or more print jobs to the printer or print server, and perform tasks such as querying the status of a printer, obtaining the status of print jobs, or canceling individual print jobs."

If open to the internet, everyone can print, or use it as a middleman for attacks.

https://www.variot.eu/

"An open IPP port can expose a lot of sensitive information such as printer name, location, model, firmware version, or even printer wifi SSID."

* https://github.com/RUB-NDS/PRET
* pip install colorama pysnmp

```bash
$ python pret.py
# look for printers
$ python pret.py file.lan ps # test language postscript
$ python pret.py <ip> pjl # Printer Job Language
$ python pret.py /dev/usb/lp0 pcl # Printer Command Language
```

http://hacking-printers.net/wiki/index.php/Printer_Security_Testing_Cheat_Sheet

PRET isn't going to work here as it is using port 9000 by default

* Brute force ssh password `nmap <MACHINE_IP> -p 22 --script ssh-brute --script-arg userdb=user.txt`
* `http://ip:631/printers/`

<hr class="sep-both">

## Bash

* https://devhints.io/bash

Debugging bash has a few built-in

```bash
$ bash -x ./file.sh
```

* `set -x code to debug set +x`

```bash
$ transport=('car' 'train' 'bike' 'bus')
$ echo "${transport[@]}"
car train bike bus
$ echo "${transport[0]}"
car
$ unset transport[1]
$ transport[1]="v"
```

* `if [] && []`
* `if [ "$x" = "$y" ]`
* https://www.codewars.com/
* https://www.hackerrank.com/

<hr class="sep-both">

## Regex

* `egrep` = `grep -E`
* https://tryhackme.com/room/catregex
* https://regexr.com/
* "a.c" means it could be "a@c"... but with "a[.]c", or "a\.c", it will match just "a.c".

```none
$ [a-z] # charset
metacharacter
$ \d digit
$ \D non-digit
$ \w alphanumerical (_, ., a-zA-Z, 0-9...)
$ \W (!#...)
$ \s whitespace
$ \S

{12} - exactly 12 times.
{1,5} - 1 to 5 times.
{2,} - 2 or more times.
* - 0 or more times.
+ - 1 or more times.

(day|night)

^\D : don't start with a digit
```

<hr class="sep-both">

## Privilege escalation

* https://www.udemy.com/course/linux-privilege-escalation/?referralCode=0B0B7AA1E52B4B7F4C06

Services

* https://www.exploit-db.com/exploits/1518
  * use mysql with root and no password, to create a root shell, using some C code.

Weak perms

* /etc/shadow
  * if "r": try bruteforce 
  * if "w": `mkpasswd -m sha-512 newpasswordhere` then edit
* /etc/passwd
  * some old Linux allow us to replace "x" with a password (`openssl passwd newpasswordhere`)
* `sudo -l`: see what I can run with sudo, https://gtfobins.github.io/
* https://github.com/TH3xACE/SUDO_KILLER
* https://blog.certcube.com/linux-privilege-escalation-with-sudo-rights/
* https://gtfobins.github.io/
* If env variables are loaded, you may exploit them too.

<hr class="sep-both">

## OSINT

* https://osintframework.com/
* https://medium.com/the-first-digit/osint-how-to-find-information-on-anyone-5029a3c7fd56
* https://github.com/Datalux/Osintgram / https://kali-linuxtr.net/osintgram-a-osint-tool-on-instagram ?
* Maltego: https://www.crackitdown.com/2018/07/maltego-full-user-guide-and-tutorial.html

<hr class="sep-both²">

## Bunch

* https://wiki.owasp.org/index.php/OWASP_Testing_Guide_v4_Table_of_Contents
* Metasploit
  * https://www.youtube.com/watch?v=kdtMthVeC1M
* Wireshark: https://unit42.paloaltonetworks.com/wireshark-workshop-videos/

"IEUser" / "Passw0rd!"
90 days.
https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/

Sudo flaw
https://thehackernews.com/2019/10/linux-sudo-run-as-root-flaw.html

* XP
  * https://helpdeskgeek.com/virtualization/how-to-set-up-a-windows-xp-virtual-machine-for-free/
  * https://helpdeskgeek.com/virtualization/virtualbox-share-folder-host-guest/ sahre must be activated
  * Must be "bridge"?
* Exploit-db + others https://securitytrails.com/blog/top-exploit-databases

<hr class="sep-both">

## metasploit

* vm2
  * https://docs.rapid7.com/metasploit/metasploitable-2/
  * msfadmin:msfadmin
  * sudo loadkeys fr
  * VBox: use existing drive
  * C:\Program Files (x86)\VMware\VMware Player\OVFTool> .\ovftool.exe "Metasploitable.vmx"  "export.ovf"
  * https://windowsloop.com/convert-vmware-to-virtualbox/
  * 2 processors
  * https://www.vulnhub.com/entry/metasploitable-2,29/
  * File > Tools > Network manager (add)
    * add to each VM instead of Nat in network
* "Usually it would be fine to run this exploit as is; however, for the sake of learning, you should do one more thing before exploiting the target. Enter the following command and press enter:" `set payload windows/x64/shell/reverse_tcp`
* https://help.tryhackme.com/106141-openvpn/606073-openvpn-general-troubleshooting
* `set LHOST tun0`
* `auxiliary/scanner/smb/smb_ms17_010` to verify that it is vulnerable
  * Modules
    * Encoders
    * Evasion
    * Exploits
    * NOPs
    * Payloads
      * single/inline: generic/shell_reverse_tcp
      * not inline= staged: shell"/"reverse_tcp
    * Post
* `show payloads`
* `set payload 1`
  * Payloads are the code that will run on the target.
* `debug`
* `help set`
* `history`
* "the tab key"
* see required options
* back...
* info

![](_images/img.png)

* https://github.com/rapid7/metasploit-framework/wiki/Exploit-Ranking
* search type:auxiliary platform:
* mfs ex> (context prompt)
* meterpreter> (the Meterpreter prompt)
* unset all
* unset xxx
* setg used in all modules
* `exploit -z` in the background
* check: check if exploitable, if supported
* background/CTRL+Z to background sessions
  * sessions
  * sessions -i <id>
* shell to meterpreter (seems useless in msf6)
  * `post/multi/manage/shell_to_meterpreter`
  * session
  * `shell`
    * `whoami`
  * `getsystem`
  * `sysinfo`
  * `ps` find NT AUTHORITY\SYSTEM and migrate to it -> `migrate pid`
  * `hashdump`
    * username
    * rid
    * LM hash
    * NTML hash - decrypt this (john nt)
  * `getuid`
  * https://www.offensive-security.com/metasploit-unleashed/meterpreter-basics/
  * Capture: https://www.offensive-security.com/metasploit-unleashed/screen-capture/
  * https://www.offensive-security.com/metasploit-unleashed/Keylogging/
* KeyLocations Windows
  * Root (cd /)
  * Documents
  * Windows/System32/config/ (sam database - where password are stored)

<hr class="sep-both">

## Nmap

* nmap -F (fast scan)
* scanme.nmap.org
* Disable intrusion detection in norton
* sudo systemctl start postgresql
* sudo msfdb init
  * I got some error, but it works
  * you need to restart msf
  * `db_status
    [*] Connected to msf. Connection type: postgresql.`
* https://www.offensive-security.com/metasploit-unleashed/using-databases/
* https://scubarda.com/2015/11/16/launching-nessus-scans-inside-metasploit/
  * `load nessus`
  * `nessus_connect user:pass@localhost:8834`
  * `nessus_scan_list`
  * `nessus_db_import id`
  * `services`
  * `vulns`
  * `vulns -s ftp`
  * `vulns -S keyword`
* https://www.techtalk7.com/detect-if-running-with-administrator-privileges-under-windows-xp/
* https://www.offensive-security.com/metasploit-unleashed/working-with-nessus/
  * MS09-050
  * search exploits 09-050
* https://tryhackme.com/resources/blog/metasploit

<hr class="sep-both">

## maltego

* `sudo apt install maltego`
* `maltego`
  * Maltego CE (free)
  * Login (https://www.maltego.com/ce-registration/)
  * ...
* https://docs.maltego.com/support/solutions/articles/15000041468-introduction-to-maltego-standard-transforms
* https://medium.com/hengky-sanjaya-blog/how-to-use-maltego-f57fe77e36e2
* https://www.maltego.com/blog/how-to-use-maltego-transforms-to-map-network-infrastructure-an-in-depth-guide/